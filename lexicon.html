<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-08-07 Mon 02:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The kcats Programming Language Lexicon</title>
<meta name="author" content="Skyrod Vactai" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<style> pre.src { background: black; color: white; } #content { max-width: 1000px } </style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="styles.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">The kcats Programming Language Lexicon</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org7de429e">1. Builtin words documentation</a>
<ul>
<li><a href="#org124f4f2">1.1. Base words</a></li>
<li><a href="#org61cedb3">1.2. Association words</a></li>
<li><a href="#orga3166bb">1.3. Sets</a></li>
<li><a href="#org2b1290a">1.4. Pipes</a></li>
</ul>
</li>
<li><a href="#org9989687">2. Lexicon</a>
<ul>
<li><a href="#orgaa5fd32">2.1. Base standard library</a></li>
<li><a href="#org450acdf">2.2. Associative words</a></li>
<li><a href="#org4a7e9ce">2.3. Methods</a></li>
<li><a href="#org7f64134">2.4. Programmable Runtime</a>
<ul>
<li><a href="#orgcc3766d">2.4.1. Other examples</a>
<ul>
<li><a href="#org888fe60">2.4.1.1. Count the number of times each word is executed while running a program.</a></li>
<li><a href="#org57b3348">2.4.1.2. <span class="todo TODO">TODO</span> spec checking</a></li>
<li><a href="#org29f525f">2.4.1.3. <span class="todo TODO">TODO</span> Trace output</a></li>
<li><a href="#orgcd7a645">2.4.1.4. <span class="done DONE">DONE</span> Step count limiting</a></li>
<li><a href="#org5fbcd92">2.4.1.5. <span class="done DONE">DONE</span> Breakpoint</a></li>
<li><a href="#orga1a80b9">2.4.1.6. <span class="todo TODO">TODO</span> Step over</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org450a23c">2.5. Pipes</a></li>
</ul>
</li>
<li><a href="#org0d36ec4">3. Issues</a>
<ul>
<li><a href="#orga39e463">3.1. <span class="done DONE">DONE</span> Get rid of platform-specific definitions</a></li>
<li><a href="#orgd81c6ce">3.2. <span class="done DONE">DONE</span> fix evaluate</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org7de429e" class="outline-2">
<h2 id="org7de429e"><span class="section-number-2">1.</span> Builtin words documentation</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org124f4f2" class="outline-3">
<h3 id="org124f4f2"><span class="section-number-3">1.1.</span> Base words</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The actual functionality of axiom words can't be defined in kcats
itself, but we can define some other properties, such as the spec
(what types the word uses and returns), and some example uses.
</p>
<div class="org-src-container">
<pre class="src src-kcats">[= [[spec [[item item] [boolean]]]
    [examples [[[1 2 =] [<span style="font-weight: bold;">false</span>]]
               [[1 1 =] [<span style="font-weight: bold;">true</span>]]
               [[[] [] =]  [<span style="font-weight: bold;">true</span>]]
               [[[1] [] =]  [<span style="font-weight: bold;">false</span>]]
               [[[1 [<span style="font-weight: bold;">false</span>]] [1 [<span style="font-weight: bold;">false</span>]] =] [<span style="font-weight: bold;">true</span>]]
               [[[1.0 [<span style="font-style: italic;">"foo"</span>]] [1.0 [<span style="font-style: italic;">"foo"</span>]] =]  [<span style="font-weight: bold;">true</span>]]
               [[<span style="font-style: italic;">"hi"</span> <span style="font-style: italic;">"hi"</span> =] [<span style="font-weight: bold;">true</span>]]
               [[<span style="font-style: italic;">"hi"</span> <span style="font-style: italic;">"there"</span> =] [<span style="font-weight: bold;">false</span>]]
               [[[] <span style="font-weight: bold;">true</span> =] [<span style="font-weight: bold;">false</span>]]
               [[[1.0 [<span style="font-style: italic;">"foo"</span>]] [1.0 [<span style="font-style: italic;">"bar"</span>]] =]  [<span style="font-weight: bold;">false</span>]]
               [[[] [] association =] [<span style="font-weight: bold;">true</span>]]
               [[[[a b]] [[a b]] association =] [<span style="font-weight: bold;">false</span>]]]]]]

[+ [[spec [[number number] [number]]]
    [examples [[[1 2 +] [3]]
               [[1.1 2.2 + 3.3 0.001 within?] [<span style="font-weight: bold;">true</span>]]
               [[1 2.2 +] [3.2]]]]]]

[- [[spec [[number number] [number]]]
    [examples [[[2 1 -] [1]]
               [[1.1 2.2 - -1.1 0.00001 within?] [<span style="font-weight: bold;">true</span>]]
               [[2.2 1 - 1.2 0.00001 within?] [<span style="font-weight: bold;">true</span>]]]]]]

[* [[spec [[number number] [number]]]
    [examples [[[4 3 *] [12]]
               [[10 1.5 * 15 0.0001 within?] [<span style="font-weight: bold;">true</span>]]
               [[5 0 *] [0]]
               [[5 -1 *] [-5]]]]]]

[/ [[spec [[number number] [number]]]
    [examples [[[12 3 /] [4]]
               [[15 1.5 /] [10.0]]
               [[0 1 /] [0]]
               [[1 0 / handle [reason] lookup] [<span style="font-style: italic;">"division by zero"</span>]]]]]]

[min [[spec [[number number] [number]]]
      [definition [[&lt;] <span style="font-weight: bold;">shield</span> [<span style="font-weight: bold;">wrap</span> [<span style="font-weight: bold;">wrap</span>] <span style="font-weight: bold;">dip</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">sink</span> <span style="font-weight: bold;">branch</span>]]
      [examples [[[2 3 min] [2]]
                 [[-5 -3 min] [-5]]
                 [[0.3 0.2 min] [0.2]]]]]]

[max [[spec [[number number] [number]]]
      [definition [[&gt;] <span style="font-weight: bold;">shield</span> [<span style="font-weight: bold;">wrap</span> [<span style="font-weight: bold;">wrap</span>] <span style="font-weight: bold;">dip</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">sink</span> <span style="font-weight: bold;">branch</span>]]
      [examples [[[2 3 max] [3]]
                 [[-5 -3 max] [-3]]
                 [[0.3 0.2 max] [0.3]]]]]]

[quot [[spec [[number number] [number]]]
       [examples [[[16 5 quot] [3]]]]]]

[rem [[spec [[number number] [number]]]
      [examples [[[17 5 rem] [2]]]]]]

[mod [[spec [[number number] [number]]]
      [examples [[[17 5 mod] [2]]]]]]

[compare [[spec [[item item] [word]]]
          [examples [[[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"b"</span> compare] [[less] <span style="font-weight: bold;">unwrap</span>]]
                     [[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"a"</span> compare] [[equal] <span style="font-weight: bold;">unwrap</span>]]
                     [[1 1 compare] [[equal] <span style="font-weight: bold;">unwrap</span>]]
                     [[2 1 compare] [[greater] <span style="font-weight: bold;">unwrap</span>]]
                     [[1 [foo] <span style="font-weight: bold;">unwrap</span> compare] [[less] <span style="font-weight: bold;">unwrap</span>]]
                     [[1 <span style="font-style: italic;">"foo"</span> bytes compare] [[less] <span style="font-weight: bold;">unwrap</span>]]
                     [[[foo] <span style="font-weight: bold;">unwrap</span> <span style="font-style: italic;">"foo"</span> bytes compare] [[less] <span style="font-weight: bold;">unwrap</span>]]
                     [[<span style="font-style: italic;">"foo"</span> bytes <span style="font-style: italic;">"foo"</span> compare] [[less] <span style="font-weight: bold;">unwrap</span>]]
                     [[] [[]] <span style="font-weight: bold;">unwrap</span> [equal]]]]]]

[&lt; [[spec [[number number] [boolean]]]
    [examples [[[1 2 &lt;] [<span style="font-weight: bold;">true</span>]]
               [[2.2 1.1 &lt;] [<span style="font-weight: bold;">false</span>]]
               [[1 2.2 &lt;] [<span style="font-weight: bold;">true</span>]]
               [[1.1 1.1 &lt;] [<span style="font-weight: bold;">false</span>]]]]]]

[&gt; [[spec [[number number] [boolean]]]
    [examples [[[2 1 &gt;] [<span style="font-weight: bold;">true</span>]]
               [[1.1 2.2 &gt;] [<span style="font-weight: bold;">false</span>]]
               [[2.2 1 &gt;] [<span style="font-weight: bold;">true</span>]]
               [[1.1 1.1 &gt;] [<span style="font-weight: bold;">false</span>]]]]]]

[&lt;= [[spec [[number number] [boolean]]]
     [examples [[[1 2 &lt;=] [<span style="font-weight: bold;">true</span>]]
                [[2.2 1.1 &lt;=] [<span style="font-weight: bold;">false</span>]]
                [[1 2.2 &lt;=] [<span style="font-weight: bold;">true</span>]]
                [[1.1 1.1 &lt;=] [<span style="font-weight: bold;">true</span>]]]]]]

[&gt;= [[spec [[number number] [boolean]]]
     [examples [[[2 1 &gt;=] [<span style="font-weight: bold;">true</span>]]
                [[1.1 2.2 &gt;=] [<span style="font-weight: bold;">false</span>]]
                [[2.2 1 &gt;=] [<span style="font-weight: bold;">true</span>]]
                [[1.1 1.1 &gt;=] [<span style="font-weight: bold;">true</span>]]]]]]

[ceil [[spec [[number] [integer]]]
       [examples [[[1.1 ceil] [2.0]]
                  [[-1.1 ceil] [-1.0]]]]]]

[sqrt [[spec [[number] [number]]]
       [examples [[[9 sqrt] [3]]
                  [[81 sqrt] [9]]]]]]

[inc [[spec [[number] [number]]]
      [examples [[[1 inc] [2]]
                 [[-1 inc] [0]]
                 [[99 inc] [100]]]]]]

[dec [[spec [[number] [number]]]
      [examples [[[2 dec] [1]]
                 [[0 dec] [-1]]
                 [[100 dec] [99]]]]]]

[abs [[spec [[number] [integer]]]
      [examples [[[2.1 abs] [2.1]]
                 [[-0.2 abs] [0.2]]
                 [[-2 abs] [2]]
                 [[0 abs] [0]]]]]]

[xor [[spec [[item] [item]]]
      [examples [[[10 12 xor] [6]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">10 = 01010, 12 = 01100, 00110, 6</span>
                 [[<span style="font-style: italic;">"foo"</span> bytes <span style="font-style: italic;">"bar"</span> bytes xor] [#b64 <span style="font-style: italic;">"BA4d"</span>]]]]]]

[++sort [[spec [[sized] [sized]]]]]

[odd? [[spec [[number] [boolean]]]
       [examples [[[1 odd?] [<span style="font-weight: bold;">true</span>]]
                  [[-1 odd?] [<span style="font-weight: bold;">true</span>]]
                  [[4 odd?] [<span style="font-weight: bold;">false</span>]]]]]]

[even? [[spec [[number] [boolean]]]
        [examples [[[2 even?] [<span style="font-weight: bold;">true</span>]]
                   [[-2 even?] [<span style="font-weight: bold;">true</span>]]
                   [[3 even?] [<span style="font-weight: bold;">false</span>]]]]]]

[zero? [[spec [[number] [boolean]]]
        [examples [[[0 zero?] [<span style="font-weight: bold;">true</span>]]
                   [[0.0 zero?] [<span style="font-weight: bold;">true</span>]]
                   [[-0.00001 zero?] [<span style="font-weight: bold;">false</span>]]
                   [[1.1 zero?] [<span style="font-weight: bold;">false</span>]]]]]]

[<span style="font-weight: bold;">drop</span> [[spec [[item] []]]
       [examples [[[1 2 3 <span style="font-weight: bold;">drop</span>] [1 2]]
                  [[1 2 3 [a b c] <span style="font-weight: bold;">drop</span>] [1 2 3]]]]]]

[<span style="font-weight: bold;">clone</span> [[spec [[[item a]]
               [[item a] [item a]]]]
        [examples [[[1 2 3 <span style="font-weight: bold;">clone</span>] [1 2 3 3]]]]]]

[<span style="font-weight: bold;">swap</span> [[spec [[[item a] [item b]]
              [[item b] [item a]]]]
       [examples [[[1 2 3 <span style="font-weight: bold;">swap</span>] [1 3 2]]]]]]

[<span style="font-weight: bold;">swapdown</span> [[spec [[[item a] [item b] [item c]]
                  [[item a] [item c] [item b]]]]
           [examples [[[1 2 3 <span style="font-weight: bold;">swapdown</span>] [2 1 3]]]]]]

[<span style="font-weight: bold;">float</span> [[spec [[[item a] [item b] [item c]]
               [[item c] [item a] [item b]]]]
        [examples [[[1 2 3 <span style="font-weight: bold;">float</span>] [2 3 1]]]]]]

[<span style="font-weight: bold;">sink</span> [[spec [[[item a] [item b] [item c]]
              [[item b] [item c] [item a]]]]
       [examples [[[1 2 3 <span style="font-weight: bold;">sink</span>] [3 1 2]]]]]]

[<span style="font-weight: bold;">execute</span> [[spec [[program] [*]]]
          [examples [[[[1 2 +] <span style="font-weight: bold;">execute</span>] [3]]
                     [[2 [+] 4 <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">execute</span>] [6]]]]]]

[<span style="font-weight: bold;">wrap</span> [[spec [[item] [list]]]
       [examples [[[1 <span style="font-weight: bold;">wrap</span>] [[1]]]
                  [[[1 2] <span style="font-weight: bold;">wrap</span>] [[[1 2]]]]]]]]

[<span style="font-weight: bold;">unwrap</span> [[spec [[list] [*]]]
         [examples [[[[1] <span style="font-weight: bold;">unwrap</span>] [1]]
                    [[[1 2 3] <span style="font-weight: bold;">unwrap</span>] [1 2 3]]]]]]

[<span style="font-weight: bold;">reverse</span> [[spec [[ordered] [ordered]]]
          [examples [[[[1 2 3] <span style="font-weight: bold;">reverse</span>] [[3 2 1]]]]]]]

[fail [[spec [[association] [*]]]]]

[<span style="font-weight: bold;">dip</span> [[spec [[program [item a]] [[item a] *]]]
      [examples [[[1 8 [inc] <span style="font-weight: bold;">dip</span>] [2 8]]
                 [[1 2 [dec] <span style="font-weight: bold;">unwrap</span>
                   [+] <span style="font-weight: bold;">dip</span>] [3 [dec] <span style="font-weight: bold;">unwrap</span>]]]]]]

[list? [[spec [[item] [boolean]]]
        [examples [[[[1] list?] [<span style="font-weight: bold;">true</span>]]
                   [[[] list?] [<span style="font-weight: bold;">true</span>]]
                   [[5 list?] [<span style="font-weight: bold;">false</span>]]]]]]

[number? [[spec [[item] [boolean]]]
          [examples [[[[1] number?] [<span style="font-weight: bold;">false</span>]]
                     [[[] number?] [<span style="font-weight: bold;">false</span>]]
                     [[5 number?] [<span style="font-weight: bold;">true</span>]]
                     [[5.01 number?] [<span style="font-weight: bold;">true</span>]]]]]]

[error? [[spec [[item] [boolean]]]]]

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">handle is a special word only used to unwind the expression on</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">error, if there's no error and we end up reaching this word, we</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ignore it.</span>
[handle [[spec [[] []]]
         [definition []]]]

[string [[spec [[item] [string]]]
         [examples [[[1 string] [<span style="font-style: italic;">"1"</span>]]
                    [[[1 2 3] string] [<span style="font-style: italic;">"[1 2 3]"</span>]]
                    [[[] string] [<span style="font-style: italic;">"[]"</span>]]]]]]

[read [[spec [[string] [item]]]
       [examples [[[<span style="font-style: italic;">"[1 [2] 3]"</span> read] [[1 [2] 3]]]]]]]

[emit [[spec [[item] [string]]]
       [examples [[[[1 [2] 3] emit] [<span style="font-style: italic;">"[1 [2] 3]"</span>]]]]]]

<span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">[inscribe [[spec [[list list] []]]</span>
<span style="font-weight: bold; font-style: italic;">;            </span><span style="font-weight: bold; font-style: italic;">[examples [[[[add3] [[definition [3 +]]</span>
<span style="font-weight: bold; font-style: italic;">;                                 </span><span style="font-weight: bold; font-style: italic;">[spec [[number] [number]]]]</span>
<span style="font-weight: bold; font-style: italic;">;                         </span><span style="font-weight: bold; font-style: italic;">inscribe</span>
<span style="font-weight: bold; font-style: italic;">;                         </span><span style="font-weight: bold; font-style: italic;">5 add3] [8]]]]]]</span>

[<span style="font-weight: bold;">branch</span> [[spec [[[program <span style="font-weight: bold;">false</span>-<span style="font-weight: bold;">branch</span>]
                 [program <span style="font-weight: bold;">true</span>-<span style="font-weight: bold;">branch</span>]
                 [item condition]]
                [*]]]
         [examples [[[5 <span style="font-weight: bold;">true</span> [3 *] [4 +] <span style="font-weight: bold;">branch</span>] [15]]
                    [[6 <span style="font-weight: bold;">false</span> [3 *] [4 +] <span style="font-weight: bold;">branch</span>] [10]]]]]]

[<span style="font-weight: bold;">step</span> [[spec [[program dispenser] [*]]]
       [examples [[[1 [2 3 4] [*] <span style="font-weight: bold;">step</span>] [24]]
                  [[1 [] [*] <span style="font-weight: bold;">step</span>] [1]]]]]]

[<span style="font-weight: bold;">recur</span> [[spec [[[program rec2]
                [program rec1]
                [program <span style="font-weight: bold;">true</span>-<span style="font-weight: bold;">branch</span>]
                [program pred]]
               [*]]]
        [examples [[[3
                     [1 &lt;=] [] [<span style="font-weight: bold;">clone</span> dec] [<span style="font-weight: bold;">execute</span> *]
                     <span style="font-weight: bold;">recur</span>]
                    [6]]]]]]

[<span style="font-weight: bold;">loop</span> [[spec [[program [item flag]] [*]]]
       [examples [[[10 <span style="font-weight: bold;">true</span> [-2 * <span style="font-weight: bold;">clone</span> 50 &lt;] <span style="font-weight: bold;">loop</span>] [160]]]]]]

[<span style="font-weight: bold;">take</span> [[spec [[dispenser] [item dispenser]]]
       [examples [[[[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"b"</span> <span style="font-style: italic;">"c"</span>] <span style="font-weight: bold;">take</span>] [[<span style="font-style: italic;">"b"</span> <span style="font-style: italic;">"c"</span>] <span style="font-style: italic;">"a"</span>]]
                  [[[1 2 3] <span style="font-weight: bold;">take</span> <span style="font-weight: bold;">dropdown</span>] [1]]]]]]

[<span style="font-weight: bold;">pop</span> [[spec [[ordered] [item ordered]]]
      [examples [[[[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"b"</span> <span style="font-style: italic;">"c"</span>] <span style="font-weight: bold;">pop</span>] [[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"b"</span>] <span style="font-style: italic;">"c"</span>]]
                 [[[1 2 3] <span style="font-weight: bold;">pop</span> <span style="font-weight: bold;">dropdown</span>] [3]]]]]]

[range [[spec [[integer integer integer] [list]]]
        [examples [[[1 5 1 range] [[1 2 3 4]]]
                   [[3 13 3 range] [[3 6 9 12]]]]]]]

[integers [[spec [[] [program]]]
           [definition [-1 [inc <span style="font-weight: bold;">clone</span>]]]]]

[<span style="font-weight: bold;">evert</span> [[spec [[list] [list *]]]
        [examples [[[1 2 3 [4 5 6] <span style="font-weight: bold;">evert</span>] [6 5 4 [3 2 1]]]]]]]

[<span style="font-weight: bold;">true</span> [[spec [[] [word]]]]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">self-inserts</span>

[<span style="font-weight: bold;">false</span> [[spec [[] [item]]]
        [definition [<span style="font-weight: bold;">nothing</span>]]]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">false = nothing = []</span>

[<span style="font-weight: bold;">nothing</span> [[spec [[] [item]]]
          [definition [[]]]]]

[and [[spec [[item item] [item]]]
      [examples [[[1 odd? 2 even? and] [<span style="font-weight: bold;">true</span>]]]]]]

[or [[spec [[item item] [item]]]
     [examples [[[1 odd? 3 even? or] [<span style="font-weight: bold;">true</span>]]
                [[1 2 or] [1]]
                [[[] 2 or] [2]]
                [[[] [] or] [<span style="font-weight: bold;">false</span>]]]]]]

[not [[spec [[item] [boolean]]]
      [examples [[[1 even? not] [<span style="font-weight: bold;">true</span>]]
                 [[<span style="font-weight: bold;">false</span> not] [<span style="font-weight: bold;">true</span>]]
                 [[<span style="font-weight: bold;">true</span> not] [<span style="font-weight: bold;">false</span>]]
                 [[[] not] [<span style="font-weight: bold;">true</span>]]]]]]

[<span style="font-weight: bold;">join</span> [[spec [[sized sized] [sized]]]
       [examples [[[[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"b"</span>] [<span style="font-style: italic;">"c"</span> <span style="font-style: italic;">"d"</span>] <span style="font-weight: bold;">join</span>] [[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"b"</span> <span style="font-style: italic;">"c"</span> <span style="font-style: italic;">"d"</span>]]]
                  [[<span style="font-style: italic;">"ab"</span> <span style="font-style: italic;">"cd"</span> <span style="font-weight: bold;">join</span>] [<span style="font-style: italic;">"abcd"</span>]]
                  [[<span style="font-style: italic;">"ab"</span> bytes <span style="font-style: italic;">"cd"</span> bytes <span style="font-weight: bold;">join</span> <span style="font-style: italic;">"abcd"</span> bytes =] [<span style="font-weight: bold;">true</span>]]
                  [[[[a b] [c d]] association [[e f] [a g]] <span style="font-weight: bold;">join</span>] [[[a g] [c d] [e f]] association]]
                  [[[[e f] [a g]] [[a b] [c d]] association  <span style="font-weight: bold;">join</span>] [[[a b] [e f] [c d]] association]]]]]]

[<span style="font-weight: bold;">put</span> [[spec [[item dispenser] [dispenser]]]
      [examples [[[[] 1 <span style="font-weight: bold;">put</span>] [[1]]]
                 [[[1 2 3] 4 <span style="font-weight: bold;">put</span>] [[1 2 3 4]]]
                 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[["foo" \d put] ["food"]] ;; breaks prod, where chars are not valid data</span>
                 [[<span style="font-style: italic;">"foo"</span> bytes 32 <span style="font-weight: bold;">put</span> string] [<span style="font-style: italic;">"foo "</span>]]]]]]

[<span style="font-weight: bold;">dipdown</span> [[spec [[program
                  [item a]
                  [item b]]
                 [[item a] [item b] *]]]
          [examples [[[1 2 3 [inc] <span style="font-weight: bold;">dipdown</span>] [2 2 3]]]]]]

[<span style="font-weight: bold;">count</span> [[spec [[sized]
               [number]]]
        [examples [[[[<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"b"</span> <span style="font-style: italic;">"c"</span>] <span style="font-weight: bold;">count</span>] [3]]]]]]

[<span style="font-weight: bold;">first</span> [[spec [[ordered] [item]]]
        [examples [[[[4 5 6] <span style="font-weight: bold;">first</span>] [4]]]]]]

[<span style="font-weight: bold;">second</span> [[spec [[ordered] [item]]]
         [examples [[[[4 5 6] <span style="font-weight: bold;">second</span>] [5]]]]]]

[<span style="font-weight: bold;">last</span> [[spec [[ordered] [item]]]
       [examples [[[[3 4 5 6] <span style="font-weight: bold;">last</span>] [6]]]]]]

[bytes [[spec [[item] [bytes]]]
        [examples [[[<span style="font-style: italic;">"foo"</span> bytes] [#b64 <span style="font-style: italic;">"Zm9v"</span>]]]]]]

[bytes? [[spec [[item] [boolean]]]
         [examples [[[<span style="font-style: italic;">"foo"</span> bytes?] [<span style="font-weight: bold;">false</span>]]
                    [[#b64 <span style="font-style: italic;">"Zm9v"</span> bytes?] [<span style="font-weight: bold;">true</span>]]
                    [[[#b64 <span style="font-style: italic;">"Zm9v"</span>] bytes?] [<span style="font-weight: bold;">false</span>]]
                    [[<span style="font-style: italic;">"foo"</span> bytes bytes?] [<span style="font-weight: bold;">true</span>]]]]]]

[pipe? [[spec [[item] [boolean]]]]]

[string? [[spec [[item] [boolean]]]
          [examples [[[<span style="font-style: italic;">"hi"</span> string?] [<span style="font-weight: bold;">true</span>]]
                     [[<span style="font-style: italic;">""</span> string?] [<span style="font-weight: bold;">true</span>]]
                     [[[<span style="font-style: italic;">"hi"</span>] string?] [<span style="font-weight: bold;">false</span>]]
                     [[<span style="font-weight: bold;">true</span> string?] [<span style="font-weight: bold;">false</span>]]]]]]

[word? [[spec [[item] [boolean]]]
        [examples [[[[foo] <span style="font-weight: bold;">unwrap</span> word?] [<span style="font-weight: bold;">true</span>]]
                   [[<span style="font-weight: bold;">true</span> word?] [<span style="font-weight: bold;">true</span>]]]]]]

[environment [[spec [[sized] [environment]]]
              [examples [[[[[expression [1 2 3]]] environment eval-<span style="font-weight: bold;">step</span> [stack] lookup] [[1]]]]]]]

[eval-<span style="font-weight: bold;">step</span> [[spec [[environment] [environment]]]
            [examples [[[[[expression [1 inc]]] environment
                         eval-<span style="font-weight: bold;">step</span> eval-<span style="font-weight: bold;">step</span>
                         [stack] lookup]
                        [[2]]]]]]]

[evaluate [[spec [[environment] [environment]]]
           [examples [[[[[expression [1 2 3 4 + *]]] environment
                        evaluate
                        [stack] lookup]
                       [[14 1]]]]]]]

[dictionary [[spec [[] [list]]]]]

[redefine [[spec [[association] []]]]]

[inspect [[spec [[item] [string]]]]]

[hash [[spec [[bytes] [bytes]]]
       [examples [[[[<span style="font-style: italic;">"foo"</span> bytes hash] 2 <span style="font-weight: bold;">times</span> =] [<span style="font-weight: bold;">true</span>]]
                  [[<span style="font-style: italic;">"foo"</span> bytes hash
                    <span style="font-style: italic;">"fop"</span> bytes hash
                    =]
                   [<span style="font-weight: bold;">false</span>]]]]]]

[key [[spec [[bytes] [bytes]]]
      [examples [[[[<span style="font-style: italic;">"foo"</span> bytes key] 2 <span style="font-weight: bold;">times</span> =] [<span style="font-weight: bold;">true</span>]]]]]]

[sign [[spec [[[bytes message] [association key]] [bytes]]]]]

[verify [[spec [[[bytes signature]
                 [bytes message]
                 [association key]]

                [boolean]]]
         [examples [[[<span style="font-style: italic;">"foo"</span> bytes key <span style="font-style: italic;">"we attack at dawn"</span> bytes [sign] <span style="font-weight: bold;">shield</span> verify] [<span style="font-weight: bold;">true</span>]]]]]]

[delegated [[spec [[[association pubkey]] [program]]]
            [definition [[[<span style="font-weight: bold;">sink</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">css cs pk</span>
                           [[bytes hash] [<span style="font-weight: bold;">shield</span> <span style="font-weight: bold;">dip</span>] decorated <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">css csh cs pk</span>
                            <span style="font-weight: bold;">float</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">cs css csh pk</span>
                            [verify] <span style="font-weight: bold;">dip</span>
                            [[]]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the program to run if the child script isn't authorized</span>
                            <span style="font-weight: bold;">branch</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">runs the child script if the sig on its hash is verified  </span>
                           [<span style="font-weight: bold;">drop</span> <span style="font-weight: bold;">drop</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the sig and (empty) child script -&gt; pk sig msg</span>
                            <span style="font-weight: bold;">sink</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">sig msg pk</span>
                            verify]
                           [<span style="font-weight: bold;">clone</span>] <span style="font-weight: bold;">dipdown</span> <span style="font-weight: bold;">branch</span>]
                          [[]] recover]
                         <span style="font-weight: bold;">swap</span> prepend]]]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">prepend the pubkey</span>
</pre>
</div>

<pre class="example">
[verify [[spec [[[bytes signature] [bytes message] [association key]] [boolean]]] [examples [[["foo" bytes key "we attack at dawn" bytes [sign] shield verify] [true]]]]]] [sign [[spec [[[bytes message] [association key]] [bytes]]]]] [key [[spec [[bytes] [bytes]]] [examples [[[["foo" bytes key] 2 times =] [true]]]]]] [hash [[spec [[bytes] [bytes]]] [examples [[[["foo" bytes hash] 2 times =] [true]] [["foo" bytes hash "fop" bytes hash =] [false]]]]]] [inspect [[spec [[item] [string]]]]] [redefine [[spec [[association] []]]]] [dictionary [[spec [[] [list]]]]] [evaluate [[spec [[list] [list]]] [examples [[[[[expression [1 2 3 4 + *]]] environment evaluate [stack] lookup] [[14 1]]]]]]] [eval-step [[spec [[list] [list]]] [examples [[[[[expression [1 inc]]] environment eval-step eval-step [stack] lookup] [[2]]]]]]] [environment [[spec [[association] [list]]] [examples [[[[[expression [1 2 3]]] environment eval-step [stack] lookup] [[1]]]]]]] [word? [[spec [[item] [boolean]]] [examples [[[[foo] unwrap word?] [true]] [[true word?] [true]]]]]] [string? [[spec [[item] [boolean]]] [examples [[["hi" string?] [true]] [["" string?] [true]] [[["hi"] string?] [false]] [[true string?] [false]]]]]] [pipe? [[spec [[item] [boolean]]]]] [bytes? [[spec [[item] [boolean]]] [examples [[["foo" bytes?] [false]] [[#b64 "Zm9v" bytes?] [true]] [[[#b64 "Zm9v"] bytes?] [false]] [["foo" bytes bytes?] [true]]]]]] [bytes [[spec [[item] [bytes]]] [examples [[["foo" bytes] [#b64 "Zm9v"]]]]]] [second [[spec [[list] [item]]] [examples [[[[4 5 6] second] [5]]]]]] [first [[spec [[list] [item]]] [examples [[[[4 5 6] first] [4]]]]]] [count [[spec [[list] [number]]] [examples [[[["a" "b" "c"] count] [3]]]]]] [dipdown [[spec [[program [item a] [item b]] [[item a] [item b] *]]] [examples [[[1 2 3 [inc] dipdown] [2 2 3]]]]]] [put [[spec [[item item] [item]]] [examples [[[[] 1 put] [[1]]] [[[1 2 3] 4 put] [[1 2 3 4]]] [["foo" bytes 32 put string] ["foo "]]]]]] [join [[spec [[item item] [item]]] [examples [[[["a" "b"] ["c" "d"] join] [["a" "b" "c" "d"]]] [["ab" "cd" join] ["abcd"]] [["ab" bytes "cd" bytes join "abcd" bytes =] [true]]]]]] [not [[spec [[item] [boolean]]] [examples [[[1 even? not] [true]] [[false not] [true]] [[true not] [false]] [[[] not] [true]]]]]] [or [[spec [[item item] [item]]] [examples [[[1 odd? 3 even? or] [true]] [[1 2 or] [1]] [[[] 2 or] [2]] [[[] [] or] [false]]]]]] [and [[spec [[item item] [item]]] [examples [[[1 odd? 2 even? and] [true]]]]]] [nothing [[spec [[] [item]]] [definition [[]]]]] [false [[spec [[] [item]]] [definition [nothing]]]] [true [[spec [[] [word]]]]] [evert [[spec [[list] [list *]]] [examples [[[1 2 3 [4 5 6] evert] [6 5 4 [3 2 1]]]]]]] [range [[spec [[integer integer integer] [list]]] [examples [[[1 5 1 range] [[1 2 3 4]]] [[3 13 3 range] [[3 6 9 12]]]]]]] [take [[spec [[item] [item list]]] [examples [[[["a" "b" "c"] take] [["b" "c"] "a"]] [[[1 2 3] take swap drop] [1]]]]]] [loop [[spec [[program [item flag]] [*]]] [examples [[[10 true [-2 * clone 50 &lt;] loop] [160]]]]]] [recur [[spec [[[program rec2] [program rec1] [program true-branch] [program pred]] [*]]] [examples [[[3 [1 &lt;=] [] [clone dec] [execute *] recur] [6]]]]]] [step [[spec [[program list] [*]]] [examples [[[1 [2 3 4] [*] step] [24]] [[1 [] [*] step] [1]]]]]] [branch [[spec [[[program false-branch] [program true-branch] [item condition]] [*]]] [examples [[[5 true [3 *] [4 +] branch] [15]] [[6 false [3 *] [4 +] branch] [10]]]]]] [emit [[spec [[item] [string]]] [examples [[[[1 [2] 3] emit] ["[1 [2] 3]"]]]]]] [read [[spec [[string] [item]]] [examples [[["[1 [2] 3]" read] [[1 [2] 3]]]]]]] [string [[spec [[item] [string]]] [examples [[[1 string] ["1"]] [[[1 2 3] string] ["[1 2 3]"]] [[[] string] ["[]"]]]]]] [handle [[spec [[] []]] [definition []]]] [error? [[spec [[item] [boolean]]]]] [number? [[spec [[item] [boolean]]] [examples [[[[1] number?] [false]] [[[] number?] [false]] [[5 number?] [true]] [[5.01 number?] [true]]]]]] [list? [[spec [[item] [boolean]]] [examples [[[[1] list?] [true]] [[[] list?] [true]] [[5 list?] [false]]]]]] [dip [[spec [[program [item a]] [[item a] *]]] [examples [[[1 8 [inc] dip] [2 8]] [[1 2 [dec] unwrap [+] dip] [3 [dec] unwrap]]]]]] [fail [[spec [[association] [*]]]]] [reverse [[spec [[list] [list]]] [examples [[[[1 2 3] reverse] [[3 2 1]]]]]]] [rest [[spec [[list] [list]]] [examples [[[[1 2 3] rest] [[2 3]]]]]]] [unwrap [[spec [[list] [*]]] [examples [[[[1] unwrap] [1]]]]]] [wrap [[spec [[item] [list]]] [examples [[[1 wrap] [[1]]] [[[1 2] wrap] [[[1 2]]]]]]]] [execute [[spec [[program] [*]]] [examples [[[[1 2 +] execute] [3]] [[2 [+] 4 swap execute] [6]]]]]] [sink [[spec [[[item a] [item b] [item c]] [[item b] [item c] [item a]]]] [examples [[[1 2 3 sink] [3 1 2]]]]]] [float [[spec [[[item a] [item b] [item c]] [[item c] [item a] [item b]]]] [examples [[[1 2 3 float] [2 3 1]]]]]] [swapdown [[spec [[[item a] [item b] [item c]] [[item a] [item c] [item b]]]] [examples [[[1 2 3 swapdown] [2 1 3]]]]]] [swap [[spec [[[item a] [item b]] [[item b] [item a]]]] [examples [[[1 2 3 swap] [1 3 2]]]]]] [clone [[spec [[[item a]] [[item a] [item a]]]] [examples [[[1 2 3 clone] [1 2 3 3]]]]]] [drop [[spec [[item] []]] [examples [[[1 2 3 drop] [1 2]] [[1 2 3 [a b c] drop] [1 2 3]]]]]] [zero? [[spec [[number] [boolean]]] [examples [[[0 zero?] [true]] [[0 zero?] [true]] [[-0.00001 zero?] [false]] [[1.1 zero?] [false]]]]]] [even? [[spec [[number] [boolean]]] [examples [[[2 even?] [true]] [[-2 even?] [true]] [[3 even?] [false]]]]]] [odd? [[spec [[number] [boolean]]] [examples [[[1 odd?] [true]] [[-1 odd?] [true]] [[4 odd?] [false]]]]]] [xor [[spec [[item] [item]]] [examples [[[10 12 xor] [6]] [["foo" bytes "bar" bytes xor] [#b64 "BA4d"]]]]]] [abs [[spec [[number] [integer]]] [examples [[[2.1 abs] [2.1]] [[-0.2 abs] [0.2]] [[-2 abs] [2]] [[0 abs] [0]]]]]] [dec [[spec [[number] [number]]] [examples [[[2 dec] [1]] [[0 dec] [-1]] [[100 dec] [99]]]]]] [inc [[spec [[number] [number]]] [examples [[[1 inc] [2]] [[-1 inc] [0]] [[99 inc] [100]]]]]] [sqrt [[spec [[number] [number]]] [examples [[[9 sqrt] [3]] [[81 sqrt] [9]]]]]] [ceil [[spec [[number] [integer]]] [examples [[[1.1 ceil] [2]] [[-1.1 ceil] [-1]]]]]] [&gt;= [[spec [[number number] [boolean]]] [examples [[[2 1 &gt;=] [true]] [[1.1 2.2 &gt;=] [false]] [[2.2 1 &gt;=] [true]] [[1.1 1.1 &gt;=] [true]]]]]] [&lt;= [[spec [[number number] [boolean]]] [examples [[[1 2 &lt;=] [true]] [[2.2 1.1 &lt;=] [false]] [[1 2.2 &lt;=] [true]] [[1.1 1.1 &lt;=] [true]]]]]] [&gt; [[spec [[number number] [boolean]]] [examples [[[2 1 &gt;] [true]] [[1.1 2.2 &gt;] [false]] [[2.2 1 &gt;] [true]] [[1.1 1.1 &gt;] [false]]]]]] [&lt; [[spec [[number number] [boolean]]] [examples [[[1 2 &lt;] [true]] [[2.2 1.1 &lt;] [false]] [[1 2.2 &lt;] [true]] [[1.1 1.1 &lt;] [false]]]]]] [mod [[spec [[number number] [number]]] [examples [[[17 5 mod] [2]]]]]] [rem [[spec [[number number] [number]]] [examples [[[17 5 rem] [2]]]]]] [quot [[spec [[number number] [number]]] [examples [[[16 5 quot] [3]]]]]] [max [[spec [[number number] [number]]] [definition [[&gt;] shield [wrap [wrap] dip] dip sink branch]] [examples [[[2 3 max] [3]] [[-5 -3 max] [-3]] [[0.3 0.2 max] [0.3]]]]]] [min [[spec [[number number] [number]]] [definition [[&lt;] shield [wrap [wrap] dip] dip sink branch]] [examples [[[2 3 min] [2]] [[-5 -3 min] [-5]] [[0.3 0.2 min] [0.2]]]]]] [/ [[spec [[number number] [number]]] [examples [[[12 3 /] [4]] [[15 1.5 /] [10]] [[0 1 /] [0]] [[1 0 / handle [reason] lookup] ["division by zero"]]]]]] [* [[spec [[number number] [number]]] [examples [[[4 3 *] [12]] [[10 1.5 * 15 0.0001 within?] [true]] [[5 0 *] [0]] [[5 -1 *] [-5]]]]]] [- [[spec [[number number] [number]]] [examples [[[2 1 -] [1]] [[1.1 2.2 - -1.1 0.00001 within?] [true]] [[2.2 1 - 1.2 0.00001 within?] [true]]]]]] [+ [[spec [[number number] [number]]] [examples [[[1 2 +] [3]] [[1.1 2.2 + 3.3 0.001 within?] [true]] [[1 2.2 +] [3.2]]]]]] [= [[spec [[item item] [boolean]]] [examples [[[1 2 =] [false]] [[1 1 =] [true]] [[[] [] =] [true]] [[[1] [] =] [false]] [[[1 [false]] [1 [false]] =] [true]] [[[1 ["foo"]] [1 ["foo"]] =] [true]] [["hi" "hi" =] [true]] [["hi" "there" =] [false]] [[[] true =] [false]] [[[1 ["foo"]] [1 ["bar"]] =] [false]] [[[] [] association =] [true]] [[[[a b]] [[a b]] association =] [false]]]]]]
</pre>
</div>
</div>


<div id="outline-container-org61cedb3" class="outline-3">
<h3 id="org61cedb3"><span class="section-number-3">1.2.</span> Association words</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-kcats">[++lookup [[spec [[item sized] [item]]]]]

[association? [[spec [[item] [boolean]]]
               [examples [[[[[a b] [c d]] association association?] [<span style="font-weight: bold;">true</span>]]
                          [[[[a b] [c d]] association?] [<span style="font-weight: bold;">false</span>]]
                          [[1 association?] [<span style="font-weight: bold;">false</span>]]
                          [[[] association?] [<span style="font-weight: bold;">true</span>]]
                          [[[] association association?] [<span style="font-weight: bold;">true</span>]]
                          [[[] [a] 1 assign association?] [<span style="font-weight: bold;">true</span>]]
                          [[[] [a] 1 assign association?] [<span style="font-weight: bold;">true</span>]]]]]]

[association [[spec [[item] [association]]]
              [examples [[[[[a b] [c d]] association
                           [[c d] [a b]] association =]
                          [<span style="font-weight: bold;">true</span>]]

                         [[[[a b] [c d]]
                           [[c d] [a b]] association =]
                          [<span style="font-weight: bold;">false</span>]]

                         [[[[a b] [c d]]
                           [[a b] [c d]] association =]

                          [<span style="font-weight: bold;">false</span>]]]]]]

[assign [[spec [[[item value]
                 [list keys]
                 sized]
                [association]]]
         [examples [[[[[a b] [c d]] [a] 5 assign]
                     [[[a 5] [c d]] association]]

                    [[[[a b] [c d]] [e] 5 assign]
                     [[[a b] [c d] [e 5]] association]]

                    [[[[a b] [c [[d e]]]] [c d] 5 assign]
                     [[[a b] [c []]] [c] [[d 5]] association assign]]

                    [[[[a b] [c [[d e]]]] [1 1 0] 5 assign]
                     [[[a b] [c [5]]]]]

                    [[[1 2 3] [1 0 0] <span style="font-style: italic;">"foo"</span> assign]
                     [[1 [[<span style="font-style: italic;">"foo"</span>]] 3]]]

                    [[[1 2 3] [1 2] <span style="font-style: italic;">"foo"</span> assign]
                     [[1 [[] [] <span style="font-style: italic;">"foo"</span>] 3]]]]]]]

[unassign [[spec [[[item key] [sized into-association]] [association]]]
           [examples [[[[[a b] [c d]] [a] unassign]
                       [[[c d]] association]]

                      [[[[a b] [c d]] [e] unassign]
                       [[[a b] [c d]] association]]

                      [[[[a [[b c] [d e]]]] [a d] unassign]
                       [[] association [a b] [c] <span style="font-weight: bold;">unwrap</span> assign]]

                      [[[0 1 2 [[a b] [c d]]] [3 c] unassign]
                       [[0 1 2] [[a b]] association <span style="font-weight: bold;">put</span>]]]]]]

[decide [[spec [[[list test-expr-pairs]] [*]]]
         [doc <span style="font-style: italic;">"Takes a list of choices (pairs of test, program) and</span>
<span style="font-style: italic;">                executes the first program whose test passes. if none</span>
<span style="font-style: italic;">                pass, returns 'nothing'. Stack is reset between</span>
<span style="font-style: italic;">                testing conditions."</span>]
         [examples [[[5 [[[3 =] [<span style="font-style: italic;">"three"</span>]]
                         [[5 =] [<span style="font-style: italic;">"five"</span>]]
                         [[7 =] [<span style="font-style: italic;">"seven"</span>]]
                         [[<span style="font-weight: bold;">true</span>] [<span style="font-style: italic;">"something else"</span>]]]
                      decide]
                     [5 <span style="font-style: italic;">"five"</span>]]

                    [[9 [[[3 =] [<span style="font-style: italic;">"three"</span>]]
                         [[5 =] [<span style="font-style: italic;">"five"</span>]]
                         [[7 =] [<span style="font-style: italic;">"seven"</span>]]
                         [[<span style="font-weight: bold;">true</span>] [<span style="font-style: italic;">"something else"</span>]]]
                      decide]

                     [9 <span style="font-style: italic;">"something else"</span>]]
                    [[9 [[[3 =] [<span style="font-style: italic;">"three"</span>]]
                         [[5 =] [<span style="font-style: italic;">"five"</span>]]
                         [[7 =] [<span style="font-style: italic;">"seven"</span>]]]
                      decide]
                     [9 []]]]]]]

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO add 'set' type for spec?</span>
[set [[spec [[item] [item]]]
      [examples [[[[1 2 3 1 2 3] set] [[1 2 3] set]]]]]]

</pre>
</div>

<pre class="example">
[decide [[spec [[[association test-expr-pairs]] [*]]] [doc "Takes a list of choices (pairs of test, program) and\n                executes the first program whose test passes. if none\n                pass, returns 'nothing'. Stack is reset between\n                testing conditions."] [examples [[[5 [[[3 =] ["three"]] [[5 =] ["five"]] [[7 =] ["seven"]] [[true] ["something else"]]] decide] [5 "five"]] [[9 [[[3 =] ["three"]] [[5 =] ["five"]] [[7 =] ["seven"]] [[true] ["something else"]]] decide] [9 "something else"]] [[9 [[[3 =] ["three"]] [[5 =] ["five"]] [[7 =] ["seven"]]] decide] [9 []]]]]]] [unassign [[spec [[[item key] association] [association]]] [examples [[[[[a b] [c d]] [a] unassign] [[[c d]] association]] [[[[a b] [c d]] [e] unassign] [[[a b] [c d]] association]] [[[[a [[b c] [d e]]]] [a d] unassign] [[] association [a b] c assign]] [[[0 1 2 [[a b] [c d]]] [3 c] unassign] [[0 1 2] [[a b]] association put]]]]]] [assign [[spec [[[item value] [list keys] association] [association]]] [examples [[[[[a b] [c d]] [a] 5 assign] [[[a 5] [c d]] association]] [[[[a b] [c d]] [e] 5 assign] [[[a b] [c d] [e 5]] association]] [[[[a b] [c [[d e]]]] [c d] 5 assign] [[[a b] [c []]] [c] [[d 5]] association assign]] [[[[a b] [c [[d e]]]] [1 1 0] 5 assign] [[[a b] [c [5]]]]] [[[1 2 3] [1 0 0] "foo" assign] [[1 [["foo"]] 3]]] [[[1 2 3] [1 2] "foo" assign] [[1 [[] [] "foo"] 3]]]]]]] [association [[spec [[item] [association]]] [examples [[[[[a b] [c d]] association [[c d] [a b]] association =] [true]] [[[[a b] [c d]] [[c d] [a b]] association =] [false]] [[[[a b] [c d]] [[a b] [c d]] association =] [false]]]]]] [association? [[spec [[item] [boolean]]] [examples [[[[[a b] [c d]] association?] [true]]]]]] [++lookup [[spec [[item association] [item]]]]]
</pre>
</div>
</div>

<div id="outline-container-orga3166bb" class="outline-3">
<h3 id="orga3166bb"><span class="section-number-3">1.3.</span> Sets</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-kcats"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO add 'set' type for spec?</span>
[set [[spec [[item] [item]]]
      [examples [[[[1 2 3 1 2 3] set] [[1 2 3] set]]]]]]

[set? [[spec [[item] [boolean]]]
       [examples [[[[1 2 3] set set?] [<span style="font-weight: bold;">true</span>]]
                  [[[1 2 3] set?] [<span style="font-weight: bold;">false</span>]]]]]]

[contains? [[spec [[item [item container]] [boolean]]]
            [examples [[[[1 2 3] 3 contains?] [<span style="font-weight: bold;">true</span>]]
                       [[[1 2 3 3 5] set 3 contains?] [<span style="font-weight: bold;">true</span>]]
                       [[[1 2 3] 4 contains?] [[]]]]]]]
</pre>
</div>
</div>
</div>
<div id="outline-container-org2b1290a" class="outline-3">
<h3 id="org2b1290a"><span class="section-number-3">1.4.</span> Pipes</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-kcats">[atom [[spec [[item] [pipe]]]]]

[buffer [[spec [[integer] [pipe]]]]]

[timeout [[spec [[integer] [pipe]]]]]

[handoff [[spec [[] [pipe]]]]]

[select [[spec [[[list pipes]] [item pipe [list pipes]]]]]]

[file-in [[spec [[string] [pipe]]]]]

[file-out [[spec [[string] [pipe]]]]]

[timestamps [[spec [[] [pipe]]]]]

[standard [[spec [[] [pipe]]]]]

[serversocket [[spec [[integer string] [pipe]]]]]

[animate [[spec [[environment] []]]]]
</pre>
</div>

<pre class="example">
[animate [[spec [[environment] []]]]] [serversocket [[spec [[integer string] [pipe]]]]] [handoff [[spec [[] [pipe]]]]] [file-out [[spec [[string] [pipe]]]]] [file-in [[spec [[string] [pipe]]]]] [spawn [[spec [[program] []]]]] [closed? [[spec [[pipe] [boolean]]]]] [close [[spec [[[pipe p]] [[pipe p]]]]]] [put [[spec [[item [pipe in]] [[pipe in]]]]]] [take [[spec [[[pipe out]] [item [pipe out]]]]]] [select [[spec [[[list pipes]] [item pipe [list pipes]]]]]] [handoff [[spec [[] [pipe]]]]] [filled [[spec [[list] [pipe]]]]] [timeout [[spec [[integer] [pipe]]]]] [buffer [[spec [[integer] [pipe]]]]] [atom [[spec [[item] [pipe]]]]]
</pre>
</div>
</div>
</div>

<div id="outline-container-org9989687" class="outline-2">
<h2 id="org9989687"><span class="section-number-2">2.</span> Lexicon</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgaa5fd32" class="outline-3">
<h3 id="orgaa5fd32"><span class="section-number-3">2.1.</span> Base standard library</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-kcats">[flip [[spec [[[item a] [item b] [item c]]
              [[item c] [item b] [item a]]]]
       [definition [<span style="font-weight: bold;">float</span> <span style="font-weight: bold;">swapdown</span>]]]]

[<span style="font-weight: bold;">dive</span> [[spec [[program [item a]] [item [item a] *]]]
       [definition [<span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">swap</span>]]]]

[<span style="font-weight: bold;">divedown</span> [[spec [[program [item a] [item b]] [item [item a] [item b] *]]]
           [definition [<span style="font-weight: bold;">dipdown</span> <span style="font-weight: bold;">float</span>]]]]

[<span style="font-weight: bold;">dropdown</span> [[spec [[[item a] [item b]] [[item b]]]]
       [definition [<span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">drop</span>]]]]

[<span style="font-weight: bold;">shield</span> [[spec [[program]
                [item]]]
         [doc <span style="font-style: italic;">"Runs program keeping top of stack produced but protects existing items from being consumed."</span>]
         [definition [[<span style="font-weight: bold;">snapshot</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">inject</span> <span style="font-weight: bold;">first</span>]]
         [examples [[[1 2 3 [=] <span style="font-weight: bold;">shield</span>] [1 2 3 <span style="font-weight: bold;">false</span>]]]]]]

[<span style="font-weight: bold;">shielddown</span> [[spec [[program item]
                    [item]]]
             [definition [<span style="font-weight: bold;">shield</span> <span style="font-weight: bold;">dropdown</span>]]
             [examples [[[1 2 3 [=] <span style="font-weight: bold;">shielddown</span>] [1 2 <span style="font-weight: bold;">false</span>]]]]]]

[<span style="font-weight: bold;">shielddeep</span> [[spec [[[program p] [item consumed] [item consumed]]
                        [[item result]]]]
                 [definition [<span style="font-weight: bold;">shield</span> [<span style="font-weight: bold;">drop</span> <span style="font-weight: bold;">drop</span>] <span style="font-weight: bold;">dip</span>]]
                 [examples [[[1 2 3 [+ +] <span style="font-weight: bold;">shielddeep</span>] [1 6]]]]]]

[<span style="font-weight: bold;">if</span> [[spec [[[program <span style="font-weight: bold;">false</span>-<span style="font-weight: bold;">branch</span>]
             [program <span style="font-weight: bold;">true</span>-<span style="font-weight: bold;">branch</span>]
             [program condition]]
            [*]]]
     [definition [[<span style="font-weight: bold;">shield</span>] <span style="font-weight: bold;">dipdown</span> <span style="font-weight: bold;">branch</span>]]
     [examples [[[5 [5 =] [3 *] [4 +] <span style="font-weight: bold;">if</span>] [15]]
                [[6 [5 =] [3 *] [4 +] <span style="font-weight: bold;">if</span>] [10]]]]]]

[<span style="font-weight: bold;">rest</span> [[spec [[list] [list]]]
       [definition [<span style="font-weight: bold;">take</span> <span style="font-weight: bold;">drop</span>]]
       [examples [[[[1 2 3] <span style="font-weight: bold;">rest</span>] [[2 3]]]]]]]

[every? [[spec [[program sized] boolean]]
         [definition [[<span style="font-weight: bold;">shielddown</span>] decorate <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">building r1, run pred with unary</span>
                      [<span style="font-weight: bold;">take</span> <span style="font-weight: bold;">swap</span>] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">put</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add rest of dip program</span>
                      [<span style="font-weight: bold;">dive</span> not] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add the rest of outer dip</span>
                      <span style="font-weight: bold;">wrap</span> [<span style="font-weight: bold;">dip</span> or] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add rest of r1</span>
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">put the other recur clauses under r1</span>
                      [[]
                       [[[<span style="font-weight: bold;">nothing</span>?] <span style="font-weight: bold;">shield</span>] <span style="font-weight: bold;">dip</span>
                        <span style="font-weight: bold;">swap</span> [or] <span style="font-weight: bold;">shielddown</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the 'if' </span>
                       [not]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">then</span>
                      <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">underneath the r1</span>
                      [<span style="font-weight: bold;">execute</span>] <span style="font-weight: bold;">recur</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">r2 and recur!</span>
                      <span style="font-weight: bold;">dropdown</span>]]
         [examples [[[[2 4 6] [even?] every?] [<span style="font-weight: bold;">true</span>]]
                    [[[2 4 5] [even?] every?] [<span style="font-weight: bold;">false</span>]]
                    [[[] [even?] every?] [<span style="font-weight: bold;">true</span>]]
                    [[[2 4 6] [] every?] [<span style="font-weight: bold;">true</span>]]
                    [[11 [2 4 6] [+ odd?] every?] [11 <span style="font-weight: bold;">true</span>]]
                    [[12 [[even?] [positive?] [3 mod 0 =]] [<span style="font-weight: bold;">execute</span>] every?] [12 <span style="font-weight: bold;">true</span>]]]]]]

[any? [[spec [[program sized] boolean]]
       [definition [[<span style="font-weight: bold;">shielddown</span>] decorate <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">building r1, run pred with unary</span>
                    [<span style="font-weight: bold;">take</span> <span style="font-weight: bold;">swap</span>] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">put</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add rest of dip program</span>
                    [<span style="font-weight: bold;">dive</span>] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add the rest of outer dip</span>
                    <span style="font-weight: bold;">wrap</span> [<span style="font-weight: bold;">dip</span> or] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add rest of r1</span>
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">put the other recur clauses under r1</span>
                    [[]
                     [[[<span style="font-weight: bold;">nothing</span>?] <span style="font-weight: bold;">shield</span>] <span style="font-weight: bold;">dip</span>
                      <span style="font-weight: bold;">swap</span> [or] <span style="font-weight: bold;">shielddown</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the 'if' </span>
                     []] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">then</span>
                    <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">underneath the r1</span>
                    [<span style="font-weight: bold;">execute</span>] <span style="font-weight: bold;">recur</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">r2 and recur!</span>
                    <span style="font-weight: bold;">dropdown</span>]]
       [examples [[[[2 4 6] [even?] any?] [<span style="font-weight: bold;">true</span>]]
                  [[[3 5 7] [even?] any?] [<span style="font-weight: bold;">false</span>]]
                  [[[] [even?] any?] [<span style="font-weight: bold;">false</span>]]
                  [[[2 4 6] [] any?] [2]]
                  [[11 [3 5 6] [+ odd?] any?] [11 <span style="font-weight: bold;">true</span>]]
                  [[-15 [[even?] [positive?] [3 mod 0 =]] [<span style="font-weight: bold;">execute</span>] any?] [-15 <span style="font-weight: bold;">true</span>]]]]]]

[primrec [[spec [[[program rec1]
                  [program exit]
                  [number data]]
                 [*]]]
          [definition [[<span style="font-weight: bold;">execute</span>] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add execute to rec1 to be recurs rec2</span>
                       [[<span style="font-weight: bold;">drop</span>] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">join</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add drop to exit condition</span>
                       [[zero?]] <span style="font-weight: bold;">dipdown</span>  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">put the condition on bottom</span>
                       [[<span style="font-weight: bold;">clone</span> dec]] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add the r1</span>
                       <span style="font-weight: bold;">recur</span>]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">now its generic recur</span>
          [examples [[[5 [1] [*] primrec] [120]]]]]]

[prepend [[spec [[item list]
                 [list]]]
          [definition [<span style="font-weight: bold;">wrap</span> <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">join</span>]]
          [examples [[[[1 2] 3 prepend] [[3 1 2]]]]]]]

[assert [[spec [[program]
                [*]]]
         [definition [<span style="font-weight: bold;">snapshot</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">save stack to print in err message</span>
                      [<span style="font-weight: bold;">shield</span>] <span style="font-weight: bold;">dive</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">run the assertion under the saved stack</span>
                      [<span style="font-weight: bold;">drop</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if passes, drop the saved stack, dont need</span>
                      [string [<span style="font-style: italic;">"assertion failed "</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">join</span> fail] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">else throw err</span>
                      <span style="font-weight: bold;">branch</span>]]]]

[<span style="font-weight: bold;">inject</span> [[spec [[program list]
                [list]]]
         [doc <span style="font-style: italic;">"Inject the quoted program into the list below</span>
<span style="font-style: italic;">                   it (runs the program with the list as its</span>
<span style="font-style: italic;">                   stack).  Does not affect the rest of the stack."</span>]
         [definition [<span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">evert</span> <span style="font-weight: bold;">take</span> <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">evert</span>]]
         [examples [[[1 2 3 [4 5 6] [* +] <span style="font-weight: bold;">inject</span>] [1 2 3 [26]]]]]]]

[<span style="font-weight: bold;">snapshot</span> [[spec [[] [list]]]
           [doc <span style="font-style: italic;">"Save the whole stack as a list on the stack"</span>]
           [definition [[] <span style="font-weight: bold;">evert</span> <span style="font-weight: bold;">clone</span> <span style="font-weight: bold;">evert</span> <span style="font-weight: bold;">unwrap</span>]]
           [examples [[[1 2 3 <span style="font-weight: bold;">snapshot</span>] [1 2 3 [3 2 1]]]
                      [[<span style="font-weight: bold;">snapshot</span>] [[]]]]]]]

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">infinite sequence (generators) functions</span>

[generate [[spec [[program item] [program item]]]
           [definition [<span style="font-weight: bold;">clone</span> [<span style="font-weight: bold;">execute</span>] <span style="font-weight: bold;">dive</span>]]
           [examples [[[1 [inc <span style="font-weight: bold;">clone</span>] generate] [2 [inc <span style="font-weight: bold;">clone</span>] 2]]]]]]

[liberate [[spec [[] [program]]]
           [definition [[<span style="font-weight: bold;">take</span>]]]]]

[collect [[spec [[program] [list]]]
          [definition [generate <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">n</span>
                       [] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">clone</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">n n r</span>
                       [<span style="font-weight: bold;">put</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">r</span>
                        [generate] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">r n</span>
                        <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">clone</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">n n r </span>
                       <span style="font-weight: bold;">loop</span> <span style="font-weight: bold;">drop</span>]]
          [examples [[[[[1 2 3 4] [<span style="font-weight: bold;">take</span>] collect] <span style="font-weight: bold;">shield</span>]
                      [[1 2 3 4]]]
                     [[[0 10 1 range [<span style="font-weight: bold;">take</span>]
                        5 dropper
                        [10 *] each
                        collect]
                       <span style="font-weight: bold;">shield</span>]
                      [[50 60 70 80 90]]]]]]]

[bail [[spec [[program] [*]]]
       [definition [[<span style="font-weight: bold;">swap</span>] [<span style="font-weight: bold;">execute</span>] [<span style="font-weight: bold;">drop</span>] <span style="font-weight: bold;">if</span>]]
       [examples [[[[] [inc] bail] [[]]]
                  [[1 [inc] bail] [2]]]]]]

[decorate [[spec [[list program] [program]]]
           [definition [[[<span style="font-weight: bold;">wrap</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">put</span>] <span style="font-weight: bold;">step</span>]]
           [examples [[[[1 inc] [foo bar] decorate] [[[[1 inc] foo] bar]]]]]]]

[decorated [[spec [[list program] [*]]]
            [definition [decorate <span style="font-weight: bold;">execute</span>]]
            [examples [[[1 2 [+] [bail <span style="font-weight: bold;">shield</span>] decorated] [1 2 3]]]]]]

[each [[spec [[program] [program]]]
       [definition [[generate] <span style="font-weight: bold;">swap</span>
                    [bail <span style="font-weight: bold;">shielddown</span>] decorate
                    <span style="font-weight: bold;">join</span>]]
       [examples [[[[[1 2 3 4] liberate
                     [<span style="font-weight: bold;">clone</span> *] each
                     collect]
                    <span style="font-weight: bold;">shield</span>]

                   [[1 4 9 16]]]]]]]

[joiner [[spec [[] [program]]]
         [definition [[generate [] <span style="font-weight: bold;">swap</span>
                       []
                       [<span style="font-weight: bold;">join</span>
                        [generate] <span style="font-weight: bold;">dive</span>] 
                       <span style="font-weight: bold;">while</span> <span style="font-weight: bold;">drop</span>]]]
         [examples [[[[[[1 2 3] [4 5 6] [7 8 9]] liberate
                       joiner
                       collect]
                      <span style="font-weight: bold;">shield</span>]

                     [[[1 2 3 4 5 6 7 8 9]]]]]]]]

[taker [[spec [[] [program]]]
        [definition [[[positive?] [dec [generate] <span style="font-weight: bold;">dive</span>] [[]] <span style="font-weight: bold;">if</span>]]]
        [examples [[[[[1 2 3 4 5] liberate
                      3 taker
                      collect]
                     <span style="font-weight: bold;">shield</span>]

                    [[1 2 3]]]]]]]

[dropper [[spec [[] [program]]]
          [definition [[[[positive?]
                         [[generate <span style="font-weight: bold;">drop</span>] <span style="font-weight: bold;">dip</span> dec]
                         <span style="font-weight: bold;">while</span>
                         [generate <span style="font-weight: bold;">swap</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">float</span>]
                        bail]]]
          [examples [[[[[1 2 3 4 5] liberate
                        3 dropper
                        collect]
                       <span style="font-weight: bold;">shield</span>]

                      [[4 5]]]]]]]
[keep [[spec [[program] [program]]]
       [definition [[not] <span style="font-weight: bold;">join</span>
                    [something?] <span style="font-weight: bold;">swap</span> pair <span style="font-weight: bold;">wrap</span> [[<span style="font-weight: bold;">execute</span>] every?] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pred that also checks for nothing first</span>
                    [<span style="font-weight: bold;">clone</span>
                     [[generate] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pred 1 </span>
                      [<span style="font-weight: bold;">drop</span> generate]
                      <span style="font-weight: bold;">while</span>]
                     <span style="font-weight: bold;">dive</span>]]]
       [examples [[[[[1 2 3 4 5] liberate
                     [odd?] keep
                     collect]
                    <span style="font-weight: bold;">shield</span>]

                   [[1 3 5]]]]]]]

[reduce [[spec [[[program reducing-function] [program generator]] [item]]]
         [definition [[<span style="font-weight: bold;">clone</span>] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-&gt; [+ clone] to build the 'then' branch</span>
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">build the loop body</span>
                      [[generate] <span style="font-weight: bold;">dive</span> []] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">put</span> [[] <span style="font-weight: bold;">if</span>] <span style="font-weight: bold;">join</span>
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">generate the first item under the loop body</span>
                      [generate <span style="font-weight: bold;">clone</span>] <span style="font-weight: bold;">dip</span>
                      <span style="font-weight: bold;">loop</span>]]
         [examples [[[[integers 1 dropper 10 taker [+] reduce] <span style="font-weight: bold;">shield</span>] [55]]]]]]

[<span style="font-weight: bold;">map</span> [[spec [[program sized] [list]]]
      [definition [[[liberate] <span style="font-weight: bold;">dip</span> each collect] <span style="font-weight: bold;">shielddeep</span>]] 
      [examples [[[[1 2 3] [inc] <span style="font-weight: bold;">map</span>] [[2 3 4]]]

                 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">multi-arity mapping functions not supported</span>
                 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">there will only be one item on the stack</span>
                 <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">[[1 [1 2 3] [+] map] [1 [2 3 4]]]</span>
                 <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">[[7 9 [1 2 3] [+ *] map] [7 9 [70 77 84]]]</span>
                 <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">[[7 9 [1 2 3] [drop drop] map] [7 9 [7 7 7]]]</span>
                 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do it this way instead</span>
                 [[1 [1 2 3] [1 <span style="font-weight: bold;">swap</span> +] <span style="font-weight: bold;">map</span>] [1 [2 3 4]]]
                 [[7 9 [1 2 3] [[7 9] <span style="font-weight: bold;">dip</span> + *] <span style="font-weight: bold;">map</span>] [7 9 [70 77 84]]]

                 [[[1 2 3] [<span style="font-weight: bold;">drop</span> 1 inc] <span style="font-weight: bold;">map</span>] [[2 2 2]]]
                 [[7 9 [+] [] <span style="font-weight: bold;">map</span>] [7 9 [+]]]]]]]

[<span style="font-weight: bold;">filter</span> [[spec [[program sized] [list]]]
         [definition [[[liberate] <span style="font-weight: bold;">dip</span> keep collect] <span style="font-weight: bold;">shielddeep</span>]]
         [examples [[[[1 2 3] [odd?] <span style="font-weight: bold;">filter</span>] [[1 3]]]
                    [[[2 4 6] [odd?] <span style="font-weight: bold;">filter</span>] [[]]]
                    [[33 [1 2 3] [33 + odd?] <span style="font-weight: bold;">filter</span>] [33 [2]]]]]]]

[sort [[spec [[program sized] [list]]]
       [definition [[<span style="font-weight: bold;">clone</span>] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">join</span>
                    [pair] <span style="font-weight: bold;">join</span>
                    <span style="font-weight: bold;">map</span> ++sort]]
       [examples [[[[1 3 2] [] sort] [[1 2 3]]]
                  [[[<span style="font-style: italic;">"Carol"</span> <span style="font-style: italic;">"Alice"</span> <span style="font-style: italic;">"bob"</span>] [] sort] [[<span style="font-style: italic;">"Alice"</span> <span style="font-style: italic;">"Bob"</span> <span style="font-style: italic;">"Carol"</span>]]]
                  [[[<span style="font-style: italic;">"Charlie"</span> <span style="font-style: italic;">"Alice"</span> <span style="font-style: italic;">"bob"</span>] [<span style="font-weight: bold;">count</span>] sort] [[<span style="font-style: italic;">"Bob"</span> <span style="font-style: italic;">"Alice"</span> <span style="font-style: italic;">"Charlie"</span>]]]]]]]

[<span style="font-weight: bold;">nothing</span>? [[spec [[item] [boolean]]]
           [definition [[] =]]
           [examples [[[[] <span style="font-weight: bold;">nothing</span>?] [<span style="font-weight: bold;">true</span>]]
                      [[1 <span style="font-weight: bold;">nothing</span>?] [<span style="font-weight: bold;">false</span>]]
                      [[<span style="font-weight: bold;">false</span> <span style="font-weight: bold;">nothing</span>?] [<span style="font-weight: bold;">true</span>]]]]]]

[something? [[spec [[item] [boolean]]]
             [definition [<span style="font-weight: bold;">nothing</span>? not]]
             [examples [[[1 something?] [<span style="font-weight: bold;">true</span>]]
                        [[<span style="font-weight: bold;">false</span> something?] [<span style="font-weight: bold;">false</span>]]
                        [[[] something?] [<span style="font-weight: bold;">false</span>]]]]]]

[<span style="font-weight: bold;">while</span> [[spec [[[program body]
                [program pred]]
               [*]]]
        [definition [<span style="font-weight: bold;">swap</span> [<span style="font-weight: bold;">shield</span>] decorate <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add shield to the pred program</span>
                     <span style="font-weight: bold;">clone</span> <span style="font-weight: bold;">dipdown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">run it on the previous ToS</span>
                     <span style="font-weight: bold;">join</span> <span style="font-weight: bold;">loop</span>]]
        [examples [[[3 [0 &gt;] [<span style="font-weight: bold;">clone</span> dec] <span style="font-weight: bold;">while</span>] [3 2 1 0]]]]]]

[<span style="font-weight: bold;">until</span> [[spec [[[program body]
                [program pred]]
               [*]]]
        [definition [<span style="font-weight: bold;">swap</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pred body</span>
                     [not] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">reverse logic</span>
                     [<span style="font-weight: bold;">shield</span>] decorate <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add shield to the pred program -&gt; pred body</span>
                     <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[body ..  pred]</span>
                     <span style="font-weight: bold;">true</span> <span style="font-weight: bold;">swap</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">run at least once</span>
                     <span style="font-weight: bold;">loop</span>]]
       [examples [[[2 [even?] [inc] <span style="font-weight: bold;">until</span>] [4]]]]]]

[<span style="font-weight: bold;">times</span> [[spec [[[integer howmany]
                [program body]]
               [*]]]
        [definition [<span style="font-weight: bold;">swap</span>
                     [dec] <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">put</span> [<span style="font-weight: bold;">dip</span>] <span style="font-weight: bold;">join</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">build [dec body dip]</span>
                     [0 &gt;] <span style="font-weight: bold;">swap</span>
                     <span style="font-weight: bold;">while</span>
                     <span style="font-weight: bold;">drop</span>]]
        [examples [[[[5] 3 <span style="font-weight: bold;">times</span>] [5 5 5]]
                   [[1 1 [inc <span style="font-weight: bold;">swap</span>] 3 <span style="font-weight: bold;">times</span>] [3 2]]]]]]

[pair [[spec [[item item] [list]]]
       [definition [[<span style="font-weight: bold;">wrap</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">put</span>]]
       [examples [[[1 2 pair] [[1 2]]]
                  [[[<span style="font-style: italic;">"hi"</span>] [<span style="font-style: italic;">"there"</span> <span style="font-style: italic;">"foo"</span>] pair] [[[<span style="font-style: italic;">"hi"</span>] [<span style="font-style: italic;">"there"</span> <span style="font-style: italic;">"foo"</span>]]]]]]]]

[both? [[spec [[program item item] [boolean]]]
        [definition [<span style="font-weight: bold;">sink</span> pair <span style="font-weight: bold;">swap</span> every?]]
        [examples [[[1 2 [odd?] both?] [<span style="font-weight: bold;">false</span>]]
                   [[1 3 [odd?] both?] [<span style="font-weight: bold;">true</span>]]]]]]

[positive? [[spec [[number] [boolean]]]
            [definition [0 &gt;]]]]

[negative? [[spec [[number] [boolean]]]
            [definition [0 &lt;]]]]

[within? [[spec [[number number] [boolean]]]
          [definition [[- abs] <span style="font-weight: bold;">dip</span> &lt;]]
          [examples [[[1.0 2.0 + 3 0.001 within?] [<span style="font-weight: bold;">true</span>]]]]]]

[recover [[spec [[program program] [*]]]
          [definition [[[handle] <span style="font-weight: bold;">join</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add handle to the end of test</span>
                       [<span style="font-weight: bold;">snapshot</span>] <span style="font-weight: bold;">dipdown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">rec test ss</span>
                       <span style="font-weight: bold;">sink</span> <span style="font-weight: bold;">inject</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">res rec</span>
                       [<span style="font-weight: bold;">first</span> error?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">err? res rec</span>
                       [<span style="font-weight: bold;">first</span> <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">execute</span>]<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drop the snapshot and run recovery</span>
                       [<span style="font-weight: bold;">evert</span> <span style="font-weight: bold;">drop</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">use snapshot as stack</span>
                       <span style="font-weight: bold;">if</span>]]
          [examples [[[[+]
                       [<span style="font-weight: bold;">drop</span> 1
                        [+] [<span style="font-weight: bold;">drop</span> 2 +]
                        recover]
                       recover]
                      [3]]

                     [[[1 2 <span style="font-style: italic;">"oh fudge"</span>]
                       [[5 +]
                        [<span style="font-weight: bold;">drop</span> 5]
                        recover]
                       <span style="font-weight: bold;">map</span>]
                      [[6 7 5]]]

                     [[[<span style="font-weight: bold;">swap</span>] [<span style="font-weight: bold;">drop</span> <span style="font-weight: bold;">swap</span>] recover]
                      [<span style="font-weight: bold;">swap</span>]]]]]]

[retry [[spec [[error] [*]]]
        [definition [[unwound] lookup
                     <span style="font-weight: bold;">execute</span>]]
        [examples [[[2 3 <span style="font-style: italic;">"four"</span> * + handle [<span style="font-weight: bold;">drop</span> 4] <span style="font-weight: bold;">dip</span> retry] [14]]]]]]

[close [[spec [[pipe] []]]
        [definition [<span style="font-weight: bold;">drop</span>]]]]

[lingo [[spec [[[program p]
                [program dictionary-modifier]] [*]]]
        [definition [dictionary <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fetch the dictionary</span>
                     <span style="font-weight: bold;">sink</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">p o d</span>
                     [<span style="font-weight: bold;">clone</span>] <span style="font-weight: bold;">dipdown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">p o d d</span>
                     [<span style="font-weight: bold;">execute</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">n=new-dict p n d</span>
                     <span style="font-weight: bold;">float</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">d p n</span>
                     <span style="font-weight: bold;">swapdown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">d n p</span>
                     [redefine <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">p</span>
                      <span style="font-weight: bold;">execute</span>]
                     <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">d</span>
                     redefine]]
        [examples [[[[[square] [[definition [<span style="font-weight: bold;">clone</span> *]]
                                [spec [[number] [number]]]] assign]
                     [9 square]
                     lingo]
                    [81]]]]]]

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">modifies a dictionary to remove any i/o capable words, for use with lingo</span>
[functional [[spec [[] [program]]]
             [definition [[[pipe-in pipe-out channel timeout
                            handoff file-in file-out timestamps
                            standard serversocket animate future
                            spit tunnel]
                           [<span style="font-weight: bold;">wrap</span> unassign] <span style="font-weight: bold;">step</span>]]]
             [examples [[[functional [<span style="font-style: italic;">"foo"</span> file-in] lingo handle type]
                         [<span style="font-style: italic;">"foo"</span> [error] <span style="font-weight: bold;">unwrap</span>]]]]]]

[let [[spec [[[program p]
              [program dictionary-modifier]] [*]]]
      [definition [[<span style="font-weight: bold;">wrap</span>
                    [[[1] [<span style="font-weight: bold;">shield</span>
                           <span style="font-weight: bold;">wrap</span>
                           [[[spec [[] [item]]]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">spec of self-insert</span>
                            [definition]] <span style="font-weight: bold;">dip</span>
                           assign] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">build a full entry</span>
                      update]
                     <span style="font-weight: bold;">map</span> association <span style="font-weight: bold;">join</span>]
                    <span style="font-weight: bold;">join</span>] <span style="font-weight: bold;">dip</span>
                   lingo]]
      [examples [[[[[a [1 1 1]]
                    [b [6 7 *]]]
                   [a b +] let] [43]]]]]]

[tos [[spec [[environment] [item]]]
      [definition [[stack] lookup <span style="font-weight: bold;">first</span>]]
      [examples [[[[[stack [1 2 3]]
                    [expression [[+] <span style="font-weight: bold;">step</span>]]]
                   tos]
                  [1]]]]]]

[toe [[spec [[environment] [item]]]
      [definition [[expression] lookup <span style="font-weight: bold;">first</span>]]
      [examples [[[[[stack [1 2 3]]
                    [expression [[+] <span style="font-weight: bold;">step</span>]]]
                   toe]
                  [[+]]]]]]]

[break [[spec [[environment [program condition]]
               [environment [program condition]]]]
        [definition [[[[[expression] lookup something?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">something still in the expression</span>
                       [<span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">execute</span> not]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">check condition not true yet</span>
                      [<span style="font-weight: bold;">execute</span>]
                      every?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">break?</span>
                     [eval-<span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
                     <span style="font-weight: bold;">while</span>]]]]

[advance [[spec [[environment] [environment]]]
          [definition [[[expression] lookup <span style="font-weight: bold;">count</span>] <span style="font-weight: bold;">shield</span> <span style="font-weight: bold;">swap</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">count up the expression length, we'll run until it's smaller than this</span>

                       [[expression] lookup <span style="font-weight: bold;">count</span>  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">only stop if expr empty or shorter than we started off</span>
                        [[positive?] [&lt;=]] [<span style="font-weight: bold;">execute</span>] every?]
                       [eval-<span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
                       <span style="font-weight: bold;">while</span>
                       <span style="font-weight: bold;">dropdown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drop the expression length item</span>
                      ]]]]

[spit [[spec [[item [item target]] []]]
       [definition [[pipe-in] <span style="font-weight: bold;">dip</span> bytes <span style="font-weight: bold;">put</span> <span style="font-weight: bold;">drop</span>]]]]

<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">[slurp [[spec [[[item target]] [item pipe]]]]]</span>
</pre>
</div>

<pre class="example">

[[recover [[spec [[program program] [*]]] [definition [[[handle] join] dip [snapshot] dipdown sink inject [first error?] [first swap execute] [evert drop] if]] [examples [[[[+] [drop 1 [+] [drop 2 +] recover] recover] [3]] [5 [1 2 "oh fudge"] [[+] [drop drop] recover] map] [5 [6 7 5]]]]]] [error? [[spec [[item] [boolean]]] [definition [[[association?] [type [error] unwrap =]] [execute] every? dropdown]]]] [zero? [[spec [[number] [boolean]]] [definition [0 =]] [examples [[[0 zero?] [true]] [[0 zero?] [true]] [[-0.00001 zero?] [false]] [[1.1 zero?] [false]]]]]] [negative? [[spec [[number] [boolean]]] [definition [0 &lt;]]]] [positive? [[spec [[number] [boolean]]] [definition [0 &gt;]]]] [both? [[spec [[program item item] [boolean]]] [definition [sink pair swap every?]] [examples [[[1 2 [odd?] both?] [false]] [[1 3 [odd?] both?] [true]]]]]] [pair [[spec [[item item] [list]]] [definition [[wrap] dip put]] [examples [[[1 2 pair] [[1 2]]] [[["hi"] ["there" "foo"] pair] [[["hi"] ["there" "foo"]]]]]]]] [times [[spec [[[program body] [integer howmany]] [*]]] [definition [[dec] swap put [dip] join [0 &gt;] swap while drop]]]] [while [[spec [[[program body] [program pred]] [*]]] [definition [swap wrap [shield] join clone dipdown join loop]] [examples [[[3 [0 &gt;] [clone dec] while] [3 2 1 0]]]]]] [something? [[spec [[item] [boolean]]] [definition [nothing? not]] [examples [[[1 something?] [true]] [[false something?] [true]] [[[] something?] [false]]]]]] [nothing? [[spec [[item] [boolean]]] [definition [[] =]] [examples [[[[] nothing?] [true]] [[1 nothing?] [false]] [[false nothing?] [false]]]]]] [filter [[spec [[program list] [list]]] [definition [[snapshot [] swap] dipdown [[clone] dip clone wrap swapdown] swap put [join inject first [[put]] [[drop]] branch swapdown dip] join step drop]] [examples [[[[1 2 3] [odd?] filter] [[1 3]]] [[[2 4 6] [odd?] filter] [[]]] [[33 [1 2 3] [+ odd?] filter] [[2] 33]]]]]] [map [[spec [[program list] [list]]] [definition [[snapshot [] swap] dipdown [wrap swap clone float] swap put [[swap join] dip inject first swap [put] dip] join step drop]] [examples [[[[1 2 3] [inc] map] [[2 3 4]]] [[1 [1 2 3] [+] map] [[2 3 4] 1]] [[7 9 [1 2 3] [+ *] map] [[70 77 84] 9 7]] [[7 9 [+] [] map] [[+] 9 7]]]]]] [snapshot [[spec [[] [list]]] [doc "Save the whole stack as a list on the stack"] [definition [[] evert clone evert unwrap]] [examples [[[1 2 3 snapshot] [1 2 3 [3 2 1]]] [[snapshot] [[]]]]]]] [inject [[spec [[program list] [list]]] [doc "Inject the quoted program into the list below\n                   it (runs the program with the list as its\n                   stack).  Does not affect the rest of the stack."] [definition [swap evert take dip evert]] [examples [[[1 2 3 [4 5 6] [* +] inject] [1 2 3 [26]]]]]]] [assert [[spec [[program] [*]]] [definition [snapshot [shield] dip swap [drop] [string ["assertion failed "] dip join fail] branch]]]] [prepend [[spec [[item list] [list]]] [definition [wrap swap join]] [examples [[[[1 2] 3 prepend] [[3 1 2]]]]]]] [primrec [[spec [[[program rec1] [program exit] [number data]] [*]]] [definition [[execute] swap join [[drop] swap join] dip [[zero?]] dipdown [[clone dec]] dip recur]] [examples [[[5 [1] [*] primrec] [120]]]]]] [any? [[spec [[program list] boolean]] [definition [[shielddown] swap prepend [take swap] swap put [dip swap] join wrap [dip or] join [false [[[nothing?] shield] dip swap [or] shielddown] []] dip [execute] recur swap drop]] [examples [[[[2 4 6] [even?] any?] [true]] [[[3 5 7] [even?] any?] [false]] [[[] [even?] any?] [false]] [[[2 4 6] [] any?] [2]] [[11 [3 5 6] [+ odd?] any?] [true 11]] [[-15 [[even?] [positive?] [3 rem 0 =]] [execute] any?] [true -15]]]]]] [every? [[spec [[program list] boolean]] [definition [[shielddown] swap prepend [take swap] swap put [dip swap not] join wrap [dip or] join [false [[[nothing?] shield] dip swap [or] shielddown] [not]] dip [execute] recur swap drop]] [examples [[[[2 4 6] [even?] every?] [true]] [[[2 4 5] [even?] every?] [false]] [[[] [even?] every?] [true]] [[[2 4 6] [] every?] [true]] [[11 [2 4 6] [+ odd?] every?] [true 11]] [[12 [[even?] [positive?] [3 rem 0 =]] [execute] every?] [true 12]]]]]] [if [[spec [[[program false-branch] [program true-branch] [program condition]] [*]]] [definition [[shield] dipdown branch]] [examples [[[5 [5 =] [3 *] [4 +] if] [15]] [[6 [5 =] [3 *] [4 +] if] [10]]]]]] [shielddeep [[spec [[[program p] [item consumed] [item consumed]] [[item result]]]] [definition [shield [drop drop] dip]] [examples [[[1 2 3 [+ +] shielddeep] [1 6]]]]]] [shielddown [[spec [[program item] [item]]] [definition [shield swap drop]] [examples [[[1 2 3 [=] shielddown] [1 2 false]]]]]] [shield [[spec [[program] [item]]] [doc "Runs program keeping top of stack produced but protects existing items from being consumed."] [definition [[snapshot] dip inject first]] [examples [[[1 2 3 [=] shield] [1 2 3 false]]]]]]]
</pre>
</div>
</div>


<div id="outline-container-org450acdf" class="outline-3">
<h3 id="org450acdf"><span class="section-number-3">2.2.</span> Associative words</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-kcats"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Associative words</span>
[update [[spec [[program [list keys] [sized into-association]]
                [association]]]
         [definition [[[lookup] <span style="font-weight: bold;">shield</span>] <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">m ks v p</span>
                      <span style="font-weight: bold;">shielddown</span>
                      assign]]
         [examples [[[[[a 1] [b 2]] [b] [inc] update]
                     [[[a 1] [b 3]] association]]

                    [[[[a [[c 3] [d 5]]] [b 2]]
                      [a c] [inc] update
                      [a c] lookup]
                     [4]]

                    [[[[a [[c 3] [d 5]]] [b 2]]
                      [a c] [<span style="font-weight: bold;">drop</span> 10 15] update
                      [a c] lookup]
                     [15]]

                    [[[[a 1] [b 2]] [d] [5] update]
                     [[[a 1] [b 2] [d 5]] association]]

                    [[[[a [[c 3] [d 5]]] [b 2]]
                      [a e] [5 6 +] update
                      [a e] lookup]
                     [11]]]]]]

[lookup [[spec [[[list keys] sized] [item]]]
         [definition [[[[<span style="font-weight: bold;">swap</span> list?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">it's a list</span>
                        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[swap something?] ;; it's not empty</span>
                        [something?]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the keylist is not empty</span>
                       [<span style="font-weight: bold;">execute</span>]
                       every?]
                      [<span style="font-weight: bold;">take</span> <span style="font-weight: bold;">swap</span> [++lookup] <span style="font-weight: bold;">dip</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">extract the first key and lookup</span>
                      <span style="font-weight: bold;">while</span>

                      [something?]
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fail if we could not drill down all the way</span>
                      [[[type error]
                        [asked [association]]
                        [reason <span style="font-style: italic;">"Lookup attempted on non-associative value"</span>]]
                       fail]
                      [<span style="font-weight: bold;">drop</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">get rid of remaining keylist</span>
                      <span style="font-weight: bold;">if</span>]]
         [examples [[[[[a b] [c d]] [a] lookup] [[b] <span style="font-weight: bold;">unwrap</span>]]
                    [[[[a b] [c d]] [e] lookup] [[]]]
                    [[[[outer [[a b] [c d]]]] [outer c] lookup] [[d] <span style="font-weight: bold;">unwrap</span>]]]]]]

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: fix the case where you just want a value [[type foo]] - only</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">one item but you want the value, not key</span>
[type [[spec [[item] [item]]]
       [definition [[[[<span style="font-weight: bold;">nothing</span>?] [[<span style="font-weight: bold;">nothing</span>] <span style="font-weight: bold;">unwrap</span>]]
                     [[word?] [[word] <span style="font-weight: bold;">unwrap</span>]]
                     [[number?] [[number] <span style="font-weight: bold;">unwrap</span>]]
                     [[string?] [[string] <span style="font-weight: bold;">unwrap</span>]]
                     [[bytes?] [[bytes] <span style="font-weight: bold;">unwrap</span>]]
                     [[pipe?] [[pipe] <span style="font-weight: bold;">unwrap</span>]]
                     [[error?] [[error] <span style="font-weight: bold;">unwrap</span>]]
                     [[association?] [[[[type] lookup]
                                       [[<span style="font-weight: bold;">count</span> 1 =]
                                        [[<span style="font-weight: bold;">first</span> [type] <span style="font-weight: bold;">unwrap</span> =]
                                         [<span style="font-weight: bold;">first</span> <span style="font-weight: bold;">second</span>]
                                         [<span style="font-weight: bold;">first</span> <span style="font-weight: bold;">first</span>]
                                         <span style="font-weight: bold;">if</span>]
                                        [[]]
                                        <span style="font-weight: bold;">if</span>]
                                       [[association] <span style="font-weight: bold;">unwrap</span>]]
                                      [<span style="font-weight: bold;">execute</span>] any?]]
                     [[list?] [[list] <span style="font-weight: bold;">unwrap</span>]]]
                    decide <span style="font-weight: bold;">dropdown</span>]]
       [examples [[[[[foo 1]] association type] [[foo] <span style="font-weight: bold;">unwrap</span>]]
                  [[1 type] [[number] <span style="font-weight: bold;">unwrap</span>]]
                  [[1.0 type] [[number] <span style="font-weight: bold;">unwrap</span>]]
                  [[[] type] [[<span style="font-weight: bold;">nothing</span>] <span style="font-weight: bold;">unwrap</span>]]
                  [[<span style="font-style: italic;">"foo"</span> bytes type] [[bytes] <span style="font-weight: bold;">unwrap</span>]]
                  [[<span style="font-style: italic;">"foo"</span> type] [[string] <span style="font-weight: bold;">unwrap</span>]]
                  [[[[type foo]] association type] [[foo] <span style="font-weight: bold;">unwrap</span>]]
                  [[[[type foo] [attr <span style="font-style: italic;">"blah"</span>]] association type] [[foo] <span style="font-weight: bold;">unwrap</span>]]
                  [[[[attr1 foo] [attr2 <span style="font-style: italic;">"blah"</span>]] association type] [[association] <span style="font-weight: bold;">unwrap</span>]]
                  [[[[type url] [value <span style="font-style: italic;">"http://foo.com"</span>]] association type] [[url] <span style="font-weight: bold;">unwrap</span>]]]]]]

[value [[spec [[[sized into-association]] [item]]]
        [definition [[<span style="font-weight: bold;">count</span> 1 =] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if it's a single item</span>
                     [<span style="font-weight: bold;">first</span> <span style="font-weight: bold;">second</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the value is the value of that first item</span>
                     [[value] lookup] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">otherwise look up the key 'value'</span>
                     <span style="font-weight: bold;">if</span>]]
        [examples [[[[[foo 1]] value] [1]]

                   [[[[type url] [value <span style="font-style: italic;">"http://foo.com"</span>]] value]
                    [<span style="font-style: italic;">"http://foo.com"</span>]]]]]]
[zip [[spec [[[list values] [list keys]] [association]]]
      [definition [[[]] <span style="font-weight: bold;">dipdown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add empty result below ToS</span>
                   [[<span style="font-weight: bold;">take</span> <span style="font-weight: bold;">wrap</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">take the next key, wrap it</span>
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">to make a "pair" (adding</span>
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">value later)</span>
                    <span style="font-weight: bold;">dip</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">run that underneath the current value</span>
                    <span style="font-weight: bold;">put</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the value into the "pair" we created earlier</span>
                    <span style="font-weight: bold;">swap</span> [<span style="font-weight: bold;">put</span>] <span style="font-weight: bold;">dip</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add the new pair to the results</span>
                   <span style="font-weight: bold;">step</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">through all the values</span>
                   <span style="font-weight: bold;">drop</span>]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the now-empty list of keys</span>
      [examples [[[[a b c] [1 2 3] zip] [[[a 1] [b 2] [c 3]]]]]]]]
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a7e9ce" class="outline-3">
<h3 id="org4a7e9ce"><span class="section-number-3">2.3.</span> Methods</h3>
<div class="outline-text-3" id="text-2-3">
<p>
We want a way of adding methods to a word that's already set up as a
simple 'decide' form. This will add the method at the beginning -
adding it at the end is not good because often there's a catchall
condition at the end, and adding beyond that means the new condition
is unreachable. Adding at the beginning is not always what the user
wants either, though. So maybe this could be improved by taking
another argument: a program to combine the item and the existing list
(that defaults to <code>prepend</code> here).
</p>
<div class="org-src-container">
<pre class="src src-kcats">[addmethod [[spec [[[pair condition] [program combinator] word] []]]
            [definition [<span style="font-weight: bold;">float</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">work with the word first to get definition: w c b</span>
                         [<span style="font-weight: bold;">wrap</span> dictionary <span style="font-weight: bold;">swap</span> lookup] <span style="font-weight: bold;">shield</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">leave the word and put def on top: def w c b</span>
                         [<span style="font-weight: bold;">wrap</span> <span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">put</span>] <span style="font-weight: bold;">divedown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[c b] def w </span>
                         [  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">b c decide cs</span>
                         <span style="font-weight: bold;">float</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">decide b c cs</span>
                         [<span style="font-weight: bold;">execute</span>] <span style="font-weight: bold;">dip</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">run combinator which will work on c cs </span>
                         <span style="font-weight: bold;">join</span> <span style="font-weight: bold;">inject</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">join with [c b], the above program to run on the definition</span>
                         <span style="font-weight: bold;">swap</span> inscribe]]]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">redefine word</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f64134" class="outline-3">
<h3 id="org7f64134"><span class="section-number-3">2.4.</span> Programmable Runtime</h3>
<div class="outline-text-3" id="text-2-4">
<p>
We can make some handy words to help debug programs.
</p>

<div class="org-src-container">
<pre class="src src-kcats">[tos [[spec [[environment] [item]]]
      [definition [[stack] lookup <span style="font-weight: bold;">first</span>]]
      [examples [[[[[stack [1 2 3]]
                    [expression [[+] <span style="font-weight: bold;">step</span>]]]
                   tos]
                  [1]]]]]]

[toe [[spec [[environment] [item]]]
      [definition [[expression] lookup <span style="font-weight: bold;">first</span>]]
      [examples [[[[[stack [1 2 3]]
                    [expression [[+] <span style="font-weight: bold;">step</span>]]]
                   toe]
                  [[+]]]]]]]

[break [[spec [[environment [program condition]]
               [environment [program condition]]]]
        [definition [[[[[expression] lookup something?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">something still in the expression</span>
                       [<span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">execute</span> not]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">check condition not true yet</span>
                      [<span style="font-weight: bold;">execute</span>]
                      every?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">break?</span>
                     [eval-<span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
                     <span style="font-weight: bold;">while</span>]]]]

[advance [[spec [[environment] [environment]]]
          [definition [[[expression] lookup <span style="font-weight: bold;">count</span>] <span style="font-weight: bold;">shield</span> <span style="font-weight: bold;">swap</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">count up the expression length, we'll run until it's smaller than this</span>

                       [[expression] lookup <span style="font-weight: bold;">count</span>  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">only stop if expr empty or shorter than we started off</span>
                        [[positive?] [&lt;=]] [<span style="font-weight: bold;">execute</span>] every?]
                       [eval-<span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
                       <span style="font-weight: bold;">while</span>
                       <span style="font-weight: bold;">dropdown</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drop the expression length item</span>
                      ]]]]
</pre>
</div>
</div>

<div id="outline-container-orgcc3766d" class="outline-4">
<h4 id="orgcc3766d"><span class="section-number-4">2.4.1.</span> Other examples</h4>
<div class="outline-text-4" id="text-2-4-1">
</div>
<div id="outline-container-org888fe60" class="outline-5">
<h5 id="org888fe60"><span class="section-number-5">2.4.1.1.</span> Count the number of times each word is executed while running a program.</h5>
<div class="outline-text-5" id="text-2-4-1-1">
<div class="org-src-container">
<pre class="src src-kcats">[[expression [10 [0 &gt;] [<span style="font-weight: bold;">clone</span> dec] <span style="font-weight: bold;">while</span>]]]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the sample program to run</span>
environment
evaluate
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">[[stack [0 1 2 3 4 5 6 7 8 9 10]] [expression []]]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kcats">10 [0 &gt;] [<span style="font-weight: bold;">clone</span> dec] <span style="font-weight: bold;">while</span>
</pre>
</div>
<pre class="example">

[0 1 2 3 4 5 6 7 8 9 10]
</pre>


<div class="org-src-container">
<pre class="src src-kcats">[<span style="font-weight: bold;">swap</span>] <span style="font-weight: bold;">unwrap</span>  word?
</pre>
</div>

<pre class="example">

[true]
</pre>


<p>
"Increment the counter, or set to 1 if nothing"
</p>
<div class="org-src-container">
<pre class="src src-kcats">[] [inc] bail 1 or
</pre>
</div>

<pre class="example">
1
</pre>


<div class="org-src-container">
<pre class="src src-kcats">[] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">empty list to put word counts in</span>
[[expression [3 [0 &gt;] [<span style="font-weight: bold;">clone</span> dec] <span style="font-weight: bold;">while</span>]]]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the sample program to run</span>
environment 
[[expression] lookup something?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">something still in the expression, keep running</span>
[[[expression] lookup <span style="font-weight: bold;">first</span>] <span style="font-weight: bold;">shield</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">get the item we're about to execute</span>
 <span style="font-weight: bold;">swap</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">put it under the environment</span>
 [[word?] <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">if it's a word</span>
  [<span style="font-weight: bold;">wrap</span>
   [[inc] bail 1 or]
   update] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the results, the count for the word about to execute</span>
  [<span style="font-weight: bold;">drop</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if it's not a word, do nothing</span>
  <span style="font-weight: bold;">if</span>] <span style="font-weight: bold;">dip</span>
 eval-<span style="font-weight: bold;">step</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
<span style="font-weight: bold;">while</span> 
<span style="font-weight: bold;">drop</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drop the environment and just report the word counts</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">[[<span style="font-weight: bold;">wrap</span> 1] [<span style="font-weight: bold;">step</span> 2] [<span style="font-weight: bold;">first</span> 4] [<span style="font-weight: bold;">snapshot</span> 4] [<span style="font-weight: bold;">execute</span> 1] [<span style="font-weight: bold;">put</span> 1] [<span style="font-weight: bold;">inject</span> 4] [<span style="font-weight: bold;">loop</span> 4] [dec 3] [decorate 1] [<span style="font-weight: bold;">swap</span> 5] [<span style="font-weight: bold;">unwrap</span> 14] [<span style="font-weight: bold;">take</span> 4] [<span style="font-weight: bold;">join</span> 1] [&gt; 4] [<span style="font-weight: bold;">while</span> 1] [<span style="font-weight: bold;">shield</span> 4] [<span style="font-weight: bold;">dipdown</span> 1] [<span style="font-weight: bold;">evert</span> 16] [<span style="font-weight: bold;">clone</span> 8] [<span style="font-weight: bold;">dip</span> 9]]
</pre>
</div>
</div>
</div>

<div id="outline-container-org57b3348" class="outline-5">
<h5 id="org57b3348"><span class="section-number-5">2.4.1.2.</span> <span class="todo TODO">TODO</span> spec checking</h5>
<div class="outline-text-5" id="text-2-4-1-2">
<p>
clojure spec check can be replaced with predicate programs, that will
be run with <code>shield</code> before the actual word and if it returns false,
will raise an error. 
</p>
</div>
</div>
<div id="outline-container-org29f525f" class="outline-5">
<h5 id="org29f525f"><span class="section-number-5">2.4.1.3.</span> <span class="todo TODO">TODO</span> Trace output</h5>
<div class="outline-text-5" id="text-2-4-1-3">
<div class="org-src-container">
<pre class="src src-kcats">[] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">results</span>
[[expression [1 [2 3 4 5] [*] <span style="font-weight: bold;">step</span>]]]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the sample program to run</span>
environment

[[expression] lookup something?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">break?</span>
[eval-<span style="font-weight: bold;">step</span> <span style="font-weight: bold;">clone</span> [<span style="font-weight: bold;">put</span>] <span style="font-weight: bold;">dip</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
<span style="font-weight: bold;">while</span>

</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">[[[stack [120]] [expression []]]
 [[[stack [1]] [expression [[2 3 4 5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[2 3 4 5] 1]] [expression [[*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[*] [2 3 4 5] 1]] [expression [<span style="font-weight: bold;">step</span>]]]
  [[stack [[*] 2 1]] [expression [<span style="font-weight: bold;">execute</span> [3 4 5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [2 1]] [expression [* [3 4 5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [2]] [expression [[3 4 5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[3 4 5] 2]] [expression [[*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[*] [3 4 5] 2]] [expression [<span style="font-weight: bold;">step</span>]]]
  [[stack [[*] 3 2]] [expression [<span style="font-weight: bold;">execute</span> [4 5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [3 2]] [expression [* [4 5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [6]] [expression [[4 5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[4 5] 6]] [expression [[*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[*] [4 5] 6]] [expression [<span style="font-weight: bold;">step</span>]]]
  [[stack [[*] 4 6]] [expression [<span style="font-weight: bold;">execute</span> [5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [4 6]] [expression [* [5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [24]] [expression [[5] [*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[5] 24]] [expression [[*] <span style="font-weight: bold;">step</span>]]]
  [[stack [[*] [5] 24]] [expression [<span style="font-weight: bold;">step</span>]]]
  [[stack [[*] 5 24]] [expression [<span style="font-weight: bold;">execute</span>]]]
  [[stack [5 24]] [expression [*]]]
  [[stack [120]] [expression []]]]]
</pre>
</div>
</div>
</div>


<div id="outline-container-orgcd7a645" class="outline-5">
<h5 id="orgcd7a645"><span class="section-number-5">2.4.1.4.</span> <span class="done DONE">DONE</span> Step count limiting</h5>
<div class="outline-text-5" id="text-2-4-1-4">
<p>
When testing or debugging, limit the number of steps to avoid a
possible infinite loop.
</p>
<div class="org-src-container">
<pre class="src src-kcats">200 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">step count remaining</span>
[[expression [10 [0 &gt;] [<span style="font-weight: bold;">clone</span> dec] <span style="font-weight: bold;">while</span>]]]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the sample program to run</span>
environment

[[expression] lookup something? <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">something still in the expression</span>
 [positive?] <span style="font-weight: bold;">dip</span> and] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">still step budget remaining</span>
[eval-<span style="font-weight: bold;">step</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
 [dec] <span style="font-weight: bold;">dip</span>] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">decrease the step budget </span>
<span style="font-weight: bold;">while</span>

<span style="font-weight: bold; font-style: italic;">;</span><span style="font-weight: bold; font-style: italic;">[stack] lookup ;; return the output</span>
</pre>
</div>

<div class="org-src-container results">
<pre class="src src-kcats">[[expression [<span style="font-weight: bold;">take</span> <span style="font-weight: bold;">dip</span> <span style="font-weight: bold;">evert</span> <span style="font-weight: bold;">first</span> [<span style="font-weight: bold;">clone</span> dec [0 &gt;] <span style="font-weight: bold;">shield</span>] <span style="font-weight: bold;">loop</span>]] [stack [[[0 &gt;] 4 5 6 7 8 9 10] 4 5 6 7 8 9 10]]] 0
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fbcd92" class="outline-5">
<h5 id="org5fbcd92"><span class="section-number-5">2.4.1.5.</span> <span class="done DONE">DONE</span> Breakpoint</h5>
<div class="outline-text-5" id="text-2-4-1-5">
<div class="org-src-container">
<pre class="src src-kcats">[[[[toe [+] <span style="font-weight: bold;">unwrap</span> =]
   [tos 3 &gt;]]
  [<span style="font-weight: bold;">execute</span>]
  every?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">when to stop - when we're about to add and tos already &gt;3</span>
 [0 [1 2 3 4 5] [+] <span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the sample program to run</span>
 environment
 
 [[[[expression] lookup something?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">something still in the expression</span>
   [<span style="font-weight: bold;">swap</span> <span style="font-weight: bold;">execute</span> not]] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">don't stop yet</span>
  [<span style="font-weight: bold;">execute</span>]
  every?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">break?</span>
 [eval-<span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
 <span style="font-weight: bold;">while</span>]
</pre>
</div>
</div>
</div>
<div id="outline-container-orga1a80b9" class="outline-5">
<h5 id="orga1a80b9"><span class="section-number-5">2.4.1.6.</span> <span class="todo TODO">TODO</span> Step over</h5>
<div class="outline-text-5" id="text-2-4-1-6">
<div class="org-src-container">
<pre class="src src-kcats">[[0 [1 2 3 4 5] [+] <span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the sample program to run</span>
 environment
 
[[expression] lookup <span style="font-weight: bold;">count</span>] <span style="font-weight: bold;">shield</span> <span style="font-weight: bold;">swap</span><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">count up the expression length, we'll run until it's smaller than this</span>
 
 [[expression] lookup <span style="font-weight: bold;">count</span>
  [[positive?] [&lt;=]] [<span style="font-weight: bold;">execute</span>] every?] <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">only stop if expr empty or shorter than we started off</span>
 [eval-<span style="font-weight: bold;">step</span>]  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">evaluate the environment one step</span>
 <span style="font-weight: bold;">while</span>]
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org450a23c" class="outline-3">
<h3 id="org450a23c"><span class="section-number-3">2.5.</span> Pipes</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-kcats">[pipe-in [[spec [[item] [pipe]]]
          [definition [association
                       [[[type [file] <span style="font-weight: bold;">unwrap</span> =]
                         [value file-in]]
                        [[type [stdout] <span style="font-weight: bold;">unwrap</span> =]
                         [stdout]]]
                       decide]]]]

[tunnel [[spec [[item] [pipe]]]
         [definition [association
                      [[[type [ip-port] <span style="font-weight: bold;">unwrap</span> =]
                        [<span style="font-weight: bold;">clone</span>
                         [port] lookup
                         [[address] lookup] <span style="font-weight: bold;">dip</span>
                         !**java.net.Socket.]]]
                      decide]]]]

[pipe-out [[spec [[item] [pipe]]]
           [definition [association
                        [[[type [file] <span style="font-weight: bold;">unwrap</span> =]
                          [value file-out]]
                         [[type [ip-port] <span style="font-weight: bold;">unwrap</span> =]
                          [<span style="font-weight: bold;">clone</span>
                           [port] lookup
                           [[address] lookup] <span style="font-weight: bold;">dip</span>
                           serversocket]]]                        
                        decide]]]]

[spit [[spec [[item [item target]] []]]
       [definition [[pipe-in] <span style="font-weight: bold;">dip</span> bytes <span style="font-weight: bold;">put</span> <span style="font-weight: bold;">drop</span>]]]]

<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">[slurp [[spec [[[item target]] [item pipe]]]]]</span>

[future [[spec [[program] [pipe]]]
         [definition [handoff <span style="font-weight: bold;">swap</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">make a pipe</span>
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">save the stack, including pipe</span>
                      [<span style="font-weight: bold;">snapshot</span>] <span style="font-weight: bold;">dip</span>
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">prepare the program for the new env</span>
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">end up with [[+ snapshot] dive put]</span>
                      [<span style="font-weight: bold;">snapshot</span>] <span style="font-weight: bold;">join</span> <span style="font-weight: bold;">wrap</span> [<span style="font-weight: bold;">dive</span> <span style="font-weight: bold;">put</span> <span style="font-weight: bold;">drop</span>] <span style="font-weight: bold;">join</span>
                      <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">;; now we have expr stack</span>
                      pair
                      [stack expression] <span style="font-weight: bold;">swap</span> zip environment
                      animate]]
         [examples [[[1 [2 +] future <span style="font-weight: bold;">take</span> <span style="font-weight: bold;">dropdown</span>] [1 [3]]]]]]]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0d36ec4" class="outline-2">
<h2 id="org0d36ec4"><span class="section-number-2">3.</span> Issues</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orga39e463" class="outline-3">
<h3 id="orga39e463"><span class="section-number-3">3.1.</span> <span class="done DONE">DONE</span> Get rid of platform-specific definitions</h3>
</div>
<div id="outline-container-orgd81c6ce" class="outline-3">
<h3 id="orgd81c6ce"><span class="section-number-3">3.2.</span> <span class="done DONE">DONE</span> fix evaluate</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-kcats">[[expression [1 1 +]]] environment evaluate [stack] lookup
</pre>
</div>

<pre class="example">

[[2]]
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Skyrod Vactai</p>
<p class="date">Created: 2023-08-07 Mon 02:03</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>